<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¥ìˆœì´ Ã— ì¥í’ì´ ê²°í˜¼ì‹ â€” ë°©ëª…ë¡</title>
  <meta name="description" content="ì¥ìˆœì´ì™€ ì¥í’ì´ì˜ ì›¨ë”© ë°©ëª…ë¡ í˜ì´ì§€ì…ë‹ˆë‹¤." />
  <style>
    :root {
      --bg: #fff7fb;      /* soft pink */
      --fg: #1f2937;
      --muted: #6b7280;
      --pink: #f472b6;    /* pink-400 */
      --pink-100: #fce7f3; /* banner bg */
      --pink-200: #fbcfe8; /* banner border */
      --purple: #8b5cf6;  /* violet-500 */
      --purple-100: #ede9fe;
      --card: #ffffff;
      --ring: rgba(139, 92, 246, 0.28);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--fg);
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== HERO ===== */
    header.hero { position: relative; }
    .hero-imgwrap { position: relative; width: 100%; height: clamp(220px, 38vw, 420px); overflow: hidden; }
    .hero-imgwrap img { width: 100%; height: 100%; object-fit: cover; display: block; filter: saturate(1.05) contrast(1.03); }
    .hero-overlay { position: absolute; inset: 0; background:
        radial-gradient(1000px 400px at 10% 10%, var(--pink-100), transparent),
        radial-gradient(800px 300px at 90% 0%, var(--purple-100), transparent),
        linear-gradient(to bottom, rgba(0,0,0,0.35), rgba(0,0,0,0.0) 45%, rgba(255,247,251,0.0) 70%, var(--bg));
      pointer-events: none; }
    .hero-inner { max-width: 1100px; margin: 0 auto; padding: 18px 16px 28px; position: relative; margin-top: -60px; }
    .badge { display: inline-block; padding: 6px 10px; border-radius: 999px; background: var(--purple-100); color: #5b21b6; font-weight: 600; font-size: 12px; box-shadow: 0 1px 0 rgba(0,0,0,0.04) inset; }
    h1 { margin: 12px 0 8px; font-size: clamp(28px, 4vw, 44px); letter-spacing: -0.5px; color: #111827; text-shadow: 0 1px 0 rgba(255,255,255,0.6); }
    .sub { color: var(--muted); margin-top: 6px; }
    .raffle { margin-top: 10px; background: var(--pink-100); color: #7c2d12; border: 1px solid var(--pink-200); padding: 10px 12px; border-radius: 12px; font-size: 14px; }
    .raffle strong { color: #9a3412; }

    /* ===== LAYOUT ===== */
    main { max-width: 1100px; margin: 0 auto 64px; padding: 0 16px; }
    .grid { display: grid; gap: 24px; grid-template-columns: 1fr; }
    @media (min-width: 980px) { .grid { grid-template-columns: 1fr 1fr; } }

    section.card { background: var(--card); border-radius: 20px; padding: 20px; box-shadow: 0 10px 24px rgba(0,0,0,0.06); border: 1px solid #edecec; }
    section.card h2 { margin: 6px 0 12px; font-size: 20px; }
    .hint { color: var(--muted); font-size: 13px; margin: 8px 0 16px; }

    /* ===== FORM ===== */
    form .row { margin-bottom: 12px; }
    label { display: block; font-weight: 600; font-size: 14px; margin-bottom: 6px; }
    input[type="text"], input[type="tel"] {
      width: 100%; padding: 12px 12px; border-radius: 12px; border: 1px solid #e5e7eb; background: #fff; font-size: 15px;
      outline: none; box-shadow: 0 1px 0 rgba(0,0,0,0.02) inset;
    }
    input:focus { border-color: var(--purple); box-shadow: 0 0 0 4px var(--ring); }
    .checkbox { display: flex; align-items: center; gap: 10px; }
    .checkbox input { width: 18px; height: 18px; accent-color: var(--purple); }
    .hp { position: absolute; left: -5000px; top: -5000px; }

    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 16px; border-radius: 12px; border: 0; color: #fff; font-weight: 700; cursor: pointer;
      background: linear-gradient(90deg, var(--pink), var(--purple)); box-shadow: 0 6px 16px rgba(139,92,246,0.25); }
    .btn[disabled] { opacity: .6; cursor: not-allowed; }
    .btn-secondary { border: 1px solid var(--purple-100); background: #f5f3ff; color: #4c1d95; font-weight: 700; padding: 10px 14px; border-radius: 12px; }
    .note { font-size: 13px; color: var(--muted); margin-top: 6px; }

    /* ë²„íŠ¼ë§Œ ì¤‘ì•™ ì •ë ¬ */
    #submitBtn{display:block;margin:12px auto 0;}

    /* ===== LIST ===== */
    .list { display: grid; gap: 12px; }
    .msg { border: 1px solid #e5e7eb; border-radius: 14px; padding: 12px 14px; background: #fff; }
    .msg-top { display: flex; align-items: baseline; gap: 8px; }
    .nick { font-weight: 700; }
    .time { font-size: 12px; color: var(--muted); }
    .text { margin: 6px 0 0; word-break: break-word; }

    .status { font-size: 13px; }
    .ok { color: #16a34a; }
    .warn { color: #a16207; }
    .err { color: #dc2626; }

    footer { text-align: center; color: var(--muted); padding: 32px 16px 56px; }
  </style>
</head>
<body>
  <header class="hero">
    <div class="hero-imgwrap">
      <img src="HERO_IMAGE_URL" alt="ì¥ìˆœì´ Ã— ì¥í’ì´ ì›¨ë”© ì´ë¯¸ì§€" />
      <div class="hero-overlay"></div>
    </div>
    <div class="hero-inner">
      <span class="badge" aria-label="ì¶•í•˜ ë°°ì§€">Wedding Guestbook</span>
      <h1>ì¥ìˆœì´ Ã— ì¥í’ì´</h1>
      <p class="sub">ì†Œì¤‘í•œ ë§ˆìŒì„ ë°©ëª…ë¡ìœ¼ë¡œ ë‚¨ê²¨ ì£¼ì„¸ìš”. ë‘ ì£¼ì¸ê³µì´ í‰ìƒ ê°„ì§í•©ë‹ˆë‹¤.</p>
      <p class="raffle"><strong>ì´ë²¤íŠ¸ ì•ˆë‚´:</strong> ë°©ëª…ë¡ì„ ë‚¨ê²¨ ì£¼ì‹  ë¶„ ì¤‘ ì¶”ì²¨ìœ¼ë¡œ <strong id="prizeName">ìŠ¤íƒ€ë²…ìŠ¤ ì¿ í°</strong>ì„ ë“œë¦½ë‹ˆë‹¤. <span id="raffleInfo">ë§ˆê° Â· ë‹¹ì²¨ì ê°œë³„ ì—°ë½</span></p>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- ì‘ì„± ì˜ì—­ -->
      <section class="card" aria-labelledby="write-title">
        <h2 id="write-title">ë°©ëª…ë¡ ë‚¨ê¸°ê¸°</h2>
        <p class="hint">
          í•„ìˆ˜ í•­ëª©ì€ <strong>ë‹‰ë„¤ì„</strong>ê³¼ <strong>í•œì¤„ ê¸€</strong>ì…ë‹ˆë‹¤.
          <strong>ì´ë²¤íŠ¸ ì°¸ì—¬ìë§Œ</strong> íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
          <em>ì´ë²¤íŠ¸ ë¯¸ì°¸ì—¬ìëŠ” ì²´í¬í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</em>
        </p>
        <form id="guestForm" novalidate>
          <div class="row">
            <label for="nickname">ë‹‰ë„¤ì„ *</label>
            <input id="nickname" name="nickname" type="text" autocomplete="nickname" required minlength="1" maxlength="30" placeholder="ì˜ˆ: ì¥í’ì´ì‚¬ë‘" />
          </div>

          <div class="row checkbox">
            <input id="eventOptin" name="eventOptin" type="checkbox" />
            <label for="eventOptin">ì´ë²¤íŠ¸ì— ì°¸ì—¬í•©ë‹ˆë‹¤(ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜)</label>
          </div>

          <div class="row" id="phoneRow">
            <label for="phone">íœ´ëŒ€í° ë²ˆí˜¸ <span class="muted">(ì´ë²¤íŠ¸ ì°¸ì—¬ ì‹œ í•„ìˆ˜)</span></label>
            <input id="phone" name="phone" type="tel" inputmode="tel" autocomplete="tel"
                   placeholder="ì˜ˆ: 010-1234-5678" maxlength="13" pattern="^[0-9-]+$" />
            <div class="note">ìˆ«ìë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ í•˜ì´í”ˆì´ ë“¤ì–´ê°‘ë‹ˆë‹¤. ê²½í’ˆ ë°œì†¡ í›„ íŒŒê¸°í•©ë‹ˆë‹¤.</div>
          </div>

          <div class="row">
            <label for="message">í•œì¤„ ê¸€ *</label>
            <input id="message" name="message" type="text" required maxlength="120" placeholder="ì¶•í•˜ ë©”ì‹œì§€ë¥¼ 120ì ì´ë‚´ë¡œ ë‚¨ê²¨ ì£¼ì„¸ìš”" />
          </div>

          <!-- ìŠ¤íŒ¸ ë°©ì§€ìš© í—ˆë‹ˆíŒŸ: ë¹„ì›Œ ë‘ì„¸ìš” -->
          <div class="hp">
            <label for="website">Leave this empty</label>
            <input id="website" name="website" type="text" tabindex="-1" autocomplete="off" />
          </div>

          <button class="btn" id="submitBtn" type="submit">ë°©ëª…ë¡ ë‚¨ê¸°ê¸°</button>
          <div id="formStatus" class="status" aria-live="polite" style="margin-top:8px"></div>
        </form>
      </section>

      <!-- ì½ê¸° ì˜ì—­ -->
      <section class="card" aria-labelledby="read-title">
        <h2 id="read-title">ëª¨ë‘ì˜ ë©”ì‹œì§€</h2>
        <div id="list" class="list" aria-live="polite"></div>
        <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
          <button id="refreshBtn" class="btn-secondary" type="button" title="ëª©ë¡ ìƒˆë¡œê³ ì¹¨">ìƒˆë¡œê³ ì¹¨</button>
          <button id="moreBtn" class="btn-secondary" type="button">ë” ë³´ê¸°</button>
          <span id="listStatus" class="status"></span>
        </div>
      </section>
    </div>

    <section class="card" style="margin-top:24px" aria-labelledby="tips-title">
      <h2 id="tips-title">ê°œì¸ì •ë³´ ë° ì´ë²¤íŠ¸ ì•ˆë‚´</h2>
      <ul>
        <li>ì´ë²¤íŠ¸ ì°¸ì—¬ìëŠ” íœ´ëŒ€í° ë²ˆí˜¸ ì œê³µì´ í•„ìš”í•©ë‹ˆë‹¤(ê²½í’ˆ ë°œì†¡Â·ë‹¹ì²¨ ì•ˆë‚´ ëª©ì ).</li>
        <li>ìˆ˜ì§‘ í•­ëª©: ë‹‰ë„¤ì„, (ì´ë²¤íŠ¸ ì°¸ì—¬ ì‹œë§Œ) íœ´ëŒ€í° ë²ˆí˜¸, í•œì¤„ ê¸€.</li>
        <li>ë³´ìœ  ê¸°ê°„: ì´ë²¤íŠ¸ ì¢…ë£Œ ë° ê²½í’ˆ ë°œì†¡ ì™„ë£Œ í›„ ì¦‰ì‹œ íŒŒê¸°.</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>ì¶•í•˜í•´ ì£¼ì…”ì„œ ê³ ë§™ìŠµë‹ˆë‹¤ ğŸ’—ğŸ’œ</p>
  </footer>

  <script>
    // ===== í™˜ê²½ì„¤ì • =====
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_GKDQNvK1xsslbT31-mznTN6-56iIdxTbJMRwPBBEYRWys4-oev_S9THOSGeFQ4l_/exec";

    // ì´ë²¤íŠ¸ ì•ˆë‚´ (í•„ìš”í•˜ë©´ ë°”ê¾¸ê¸°)
    const RAFFLE = { PRIZE_NAME: "ìŠ¤íƒ€ë²…ìŠ¤ ì¿ í°", PRIZES_COUNT: 5, DEADLINE: "2025-11-30 23:59", CONTACT: "ë‹¹ì²¨ì ê°œë³„ ì—°ë½" };

    // ëª©ë¡ í˜ì´ì§•
    const PAGE_SIZE = 20; let loadedCount = 0;

    // ìœ í‹¸
    const $ = (sel, el=document) => el.querySelector(sel);
    function setStatus(el, msg, cls){ el.textContent = msg || ''; el.className = `status ${cls||''}`; }
    function digitsOnly(s){ return String(s||'').replace(/\D/g,''); }
    function formatKoreanPhone(d){
      if(d.length <= 3) return d;
      if(d.length <= 7) return d.slice(0,3)+'-'+d.slice(3);
      if(d.length === 10) return d.slice(0,3)+'-'+d.slice(3,6)+'-'+d.slice(6);
      return d.slice(0,3)+'-'+d.slice(3,7)+'-'+d.slice(7,11);
    }
    function handlePhoneInput(){
      const el = $("#phone"); const d = digitsOnly(el.value).slice(0,11);
      el.value = formatKoreanPhone(d);
    }
    function togglePhoneRequired(){
      const checked = $("#eventOptin").checked; const phone = $("#phone");
      if(checked){ phone.setAttribute('required','required'); } else { phone.removeAttribute('required'); }
    }
    function setRaffleText(){
      const txt = `ì¶”ì²¨ ${RAFFLE.PRIZES_COUNT}ëª… / ë§ˆê°: ${RAFFLE.DEADLINE} / ${RAFFLE.CONTACT}`;
      const PN = document.getElementById("prizeName"); if(PN) PN.textContent = RAFFLE.PRIZE_NAME;
      const RI = document.getElementById("raffleInfo"); if(RI) RI.textContent = txt;
    }

    // ===== ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (fetch â†’ ì‹¤íŒ¨ ì‹œ JSONP í´ë°±) =====
    async function loadMessages(){
      const listStatus = $("#listStatus");
      const nextCount = loadedCount + PAGE_SIZE;
      try {
        setStatus(listStatus, "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦", "warn");
        const url = `${SCRIPT_URL}?mode=list&limit=${nextCount}&_=${Date.now()}`;
        const res = await fetch(url, { method: 'GET' });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const rows = (data && data.rows) || [];
        renderList(rows); loadedCount = rows.length;
        setStatus(listStatus, `${loadedCount}ê°œ í‘œì‹œ`, "");
        $("#moreBtn").style.display = rows.length < nextCount ? 'none' : 'inline-flex';
      } catch(err){
        jsonpLoad(nextCount);
      }
    }

    function jsonpLoad(limit){
      const listStatus = $("#listStatus");
      setStatus(listStatus, "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦(JSONP)", "warn");
      const cbName = `__guestbookCB_${Date.now()}`;
      window[cbName] = (data)=>{
        try{
          const rows = (data && data.rows) || [];
          renderList(rows); loadedCount = rows.length;
          setStatus(listStatus, `${loadedCount}ê°œ í‘œì‹œ`, "");
          $("#moreBtn").style.display = rows.length < limit ? 'none' : 'inline-flex';
        } finally {
          delete window[cbName]; s.remove();
        }
      };
      const s = document.createElement('script');
      s.src = `${SCRIPT_URL}?mode=list&limit=${limit}&callback=${cbName}&_=${Date.now()}`;
      s.onerror = ()=>{ setStatus(listStatus, `ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤`, "err"); s.remove(); delete window[cbName]; };
      document.body.appendChild(s);
    }

    function renderList(rows){
      const list = $("#list");
      list.replaceChildren(...rows.map(createMsgEl));
    }
    function createMsgEl(r){
      const art = document.createElement('article'); art.className = 'msg';
      const top = document.createElement('div'); top.className = 'msg-top';
      const nick = document.createElement('span'); nick.className = 'nick'; nick.textContent = r.nickname || 'ìµëª…';
      const time = document.createElement('span'); time.className = 'time'; time.textContent = r.timestamp || '';
      const p = document.createElement('p'); p.className = 'text'; p.textContent = r.message || '';
      top.append(nick, time); art.append(top, p); return art;
    }

    // ===== ì´ë²¤íŠ¸ =====
    $("#eventOptin").addEventListener('change', togglePhoneRequired);
    $("#phone").addEventListener('input', handlePhoneInput);
    $("#moreBtn").addEventListener('click', () => loadMessages());
    $("#refreshBtn").addEventListener('click', () => { loadedCount = 0; loadMessages(); });

    $("#guestForm").addEventListener('submit', async (e)=>{
      e.preventDefault();
      const status = $("#formStatus"); const btn = $("#submitBtn");
      if($("#website").value){ setStatus(status, "ìŠ¤íŒ¸ì´ ì˜ì‹¬ë˜ì–´ ì „ì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "err"); return; }

      const nickname = $("#nickname").value.trim();
      const eventOptin = $("#eventOptin").checked;
      const phoneDigits = digitsOnly($("#phone").value.trim());
      const message = $("#message").value.trim();

      if(!nickname || nickname.length > 30){ setStatus(status, "ë‹‰ë„¤ì„ì„ 1â€“30ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "err"); return; }
      if(!eventOptin && phoneDigits.length > 0){
        setStatus(status, "ì´ë²¤íŠ¸ ì°¸ì—¬ìë§Œ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤. ì°¸ì—¬í•˜ë ¤ë©´ ì´ë²¤íŠ¸ ì²´í¬ë¥¼ í•´ ì£¼ì„¸ìš”.", "err"); return;
      }
      if(eventOptin && (phoneDigits.length < 10 || phoneDigits.length > 11)){
        setStatus(status, "íœ´ëŒ€í° ë²ˆí˜¸ëŠ” 10~11ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.", "err"); return;
      }
      if(!message){ setStatus(status, "í•œì¤„ ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.", "err"); return; }

      try {
        btn.disabled = true; setStatus(status, "ì „ì†¡ ì¤‘â€¦", "warn");

        // í”„ë¦¬í”Œë¼ì´íŠ¸ íšŒí”¼: urlencoded ë¡œ ì „ì†¡(í—¤ë” ì§€ì • ì•ˆ í•¨)
        const body = new URLSearchParams({
          nickname,
          message,
          eventOptin: eventOptin ? 'true' : 'false',
          phone: eventOptin ? formatKoreanPhone(phoneDigits) : ''
        });
        const res = await fetch(SCRIPT_URL, { method: 'POST', body });
        try { if(res && res.ok){ await res.text(); } } catch(_) {}

        setStatus(status, "ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì¶•í•˜ì™€ ì‘ì›ì— ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!", "ok");
        $("#message").value = '';
        if(!eventOptin){ $("#phone").value = ''; }
        await loadMessages();
        document.getElementById("read-title").scrollIntoView({ behavior: 'smooth', block: 'start' });
      } catch(err){
        setStatus(status, `ì „ì†¡ ì‹¤íŒ¨: ${err}`, "err");
      } finally {
        btn.disabled = false;
      }
    });

    // ì´ˆê¸°í™”
    setRaffleText(); togglePhoneRequired(); loadMessages();
  </script>
</body>
</html>
