<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>누누 캐릭터 티셔츠 주문</title>
  <style>
    :root{
      --bg:#ffffff; --paper:#ffffff; --ink:#111827; --sub:#6b7280;
      --pri:#4b5563; --muted:#e5e7eb; --ring:rgba(107,114,128,.25);
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --green:#059669; --blue:#1e3a8a;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:20px 16px}

    /* NAV */
    header.nav{position:sticky;top:0;backdrop-filter:saturate(180%) blur(8px);background:rgba(247,246,243,.75);border-bottom:1px solid var(--muted);z-index:50}
    .nav-inner{display:flex;align-items:center;justify-content:flex-end;gap:12px;padding:10px 16px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:9px 12px;border-radius:999px;border:1px solid var(--muted);
      background:var(--paper);color:var(--ink);text-decoration:none;font-weight:600;
    }
    .btn.primary{background:var(--pri);color:#fff;border:0}
    .btn.success{background:var(--green);color:#fff;border:0}
    .btn:hover{box-shadow:0 6px 18px rgba(15,23,42,.08)}
    .btn.lg{font-size:16px; padding:10px 18px; min-height:42px; min-width:140px}
    @media (min-width:768px){ .btn.lg{font-size:17px; padding:12px 22px; min-width:180px} }

    /* 카드 */
    .card{background:var(--paper);border:1px solid var(--muted);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    .card .inner{padding:16px}

    /* 히어로: 이미지 크게 + 설명은 아래 */
    .hero{margin:16px auto;border-radius:20px}
    .p-hero{display:flex;flex-direction:column;gap:12px}
    .p-hero h1{margin:0;font-size:clamp(22px,4vw,30px);letter-spacing:-.2px}
    .p-hero .lead{margin:0;color:var(--sub)}
    .media{
      position:relative; border:1px solid var(--muted); border-radius:14px; overflow:hidden; background:#f3f4f6;
      cursor: zoom-in;
    }
    .media img{
      display:block; width:100%; height:auto; transform-origin:center center; transition:transform .18s ease;
    }
    /* ✅ 확대 배율 3배 */
    .media.zoomed{ cursor: zoom-out; }
    .media.zoomed img{ transform: scale(3); }
    .zoom-hint{
      position:absolute; right:10px; bottom:10px; background:rgba(17,24,39,.6); color:#fff;
      font-size:12px; padding:6px 8px; border-radius:999px;
    }

    /* 리스트 */
    .bullets{margin:8px 0 0; padding-left:18px; color:#374151}
    .bullets li{margin:4px 0}

    /* 섹션 타이틀 */
    h2{margin:0 0 8px;font-size:20px}
    h3{margin:10px 0 8px; font-size:18px}

    /* 입력 */
    label{font-weight:700;display:block;margin-bottom:6px}
    .subnote{color:var(--sub);font-size:12px;margin-top:4px}
    input[type="text"], input[type="tel"]{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--muted); outline:none; background:#fff;
    }
    input[type="text"]:focus, input[type="tel"]:focus{box-shadow:0 0 0 3px var(--ring)}
    input.invalid{border-color:#fca5a5; box-shadow:0 0 0 2px rgba(239,68,68,.2)}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){ .grid{grid-template-columns:1fr} }

    .addr-row{display:grid; grid-template-columns:130px 1fr auto; gap:8px}
    .addr-row .btn{white-space:nowrap}
    @media (max-width:560px){ .addr-row{grid-template-columns:1fr 1fr} .addr-row .btn{grid-column:1/3} }

    /* 라디오 그룹 */
    .radios{display:flex;gap:10px;flex-wrap:wrap}
    .radio{
      display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--muted);
      border-radius:999px;background:#fff;cursor:pointer;user-select:none
    }
    .radio input{accent-color:#2563eb}

    /* 사이즈 정보 표 */
    .size-wrap{margin-top:12px}
    .size-scroll{overflow:auto; -webkit-overflow-scrolling:touch}
    .size-table{
      width:100%; min-width: 640px;            /* ✅ 모바일 겹침 방지: 최소 가로폭 부여 */
      border-collapse:separate; border-spacing:0; border:1px solid var(--muted);
      border-radius:12px; overflow:hidden; background:#fff; table-layout:fixed;
    }
    .size-table th, .size-table td{
      padding:10px 12px; border-bottom:1px solid #f1f5f9; text-align:center; white-space:nowrap
    }
    .size-table thead th{background:#f8fafc; color:#334155}
    /* ✅ 첫 칼럼/사이즈 칼럼 최소폭으로 겹침 방지 */
    .size-table th:first-child, .size-table td:first-child{min-width: 120px;}
    .size-table th:not(:first-child), .size-table td:not(:first-child){min-width: 80px;}
    @media (max-width:560px){
      .size-table th, .size-table td{ padding:8px 10px; font-size:14px; }
    }
    .size-note{color:var(--sub); font-size:12px; margin-top:6px}

    /* 사이즈별 수량 */
    .sizes{display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:10px}
    .size-box{
      border:1px solid var(--muted); border-radius:12px; padding:12px; background:#fff;
      display:flex; align-items:center; justify-content:space-between; gap:10px; min-width:0;
    }
    .size-label{font-weight:800; white-space:nowrap}
    .stepper{display:flex; align-items:center; justify-content:center; gap:6px}
    .stepper button{
      width:44px; height:44px; border-radius:10px; border:1px solid var(--muted); background:#fff;
      font-size:20px; line-height:1; cursor:pointer;
    }
    .stepper input{
      width:64px; text-align:center; padding:10px; border-radius:10px; border:1px solid var(--muted); background:#fff;
      font-size:16px;
    }
    @media (max-width: 720px){
      .sizes{ grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); }
      .stepper button{ width:40px; height:40px; }
      .stepper input{ width:56px; padding:8px; }
    }
    @media (max-width: 400px){
      .sizes{ grid-template-columns: 1fr; }
      .stepper button{ width:38px; height:38px; }
      .stepper input{ width:52px; padding:8px; }
    }

    /* 요약/가격 */
    .summary{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .summary .line{
      display:flex; align-items:center; justify-content:space-between;
      border:1px solid var(--muted); border-radius:10px; padding:10px 12px; background:#fff;
      min-width:0;
    }
    .summary .line span{
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex:1; margin-right:10px;
    }
    .summary .line b{ white-space:nowrap; flex:0 0 auto; }
    .summary .total{grid-column:1/-1; font-weight:900; font-size:18px; color:#111827; border-color:#cbd5e1}
    @media (max-width:560px){
      .summary{ grid-template-columns:1fr; }
      .summary .line{ font-size:15px; }
    }

    .actions{display:flex;gap:12px;justify-content:center;margin-top:10px}
    #status{min-height:24px;text-align:center;margin-top:6px}
    .notice{font-weight:700}
    .notice-ok{color:#065f46}
    .notice-err{color:#b91c1c}
  </style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner wrap">
      <a class="btn" href="index.html">Home</a>
    </div>
  </header>

  <main class="wrap">
    <!-- 히어로 -->
    <section class="card hero">
      <div class="inner p-hero">
        <div class="media" id="media">
          <img src="https://www.hanri.net/nunu/nunu_tshirt_image.png" alt="누누 캐릭터 티셔츠" id="prodImg">
          <span class="zoom-hint">탭/클릭 시 크게 보기</span>
        </div>
        <h1>누누 캐릭터 티셔츠</h1>
        <p class="lead">
          귀여운 누에와 하루를 함께 시작해보세요! 부드러운 코튼 원단에 귀여운 누에을 더한 데일리 티셔츠입니다.
          흰색/검은색 2가지 색상과 뒷면 옵션 없음·텍스트형 중 선택 가능합니다. 누에엥~
        </p>

        <ul class="bullets">
          <li><b>소재</b>: 면 100% (애쉬: 면 95% + 폴리 5%, 모쿠그레이: 면 80% + 폴리 20%)</li>
          <li><b>제조사/제조국</b>: Printstar / Made in China</li>
          <li><b>핏</b>: 정사이즈(남녀공용) · <b>신축성</b>: 좋음 · <b>감촉</b>: 부드러움 · <b>두께</b>: 도톰</li>
          <li><b>뒷면 옵션</b>: 없음 <b>16,000원</b> / 텍스트형 <b>23,000원</b> (품목가)</li>
          <li><b>배송비</b>: 4,000원 (주문 건당 고정)</li>
          <li><b>입금 계좌</b>: 한리 농협 302-1235-6391-61</li>
          <li style="color:#b45309"><b>안내</b>: 뒷면 옵션이 다른 경우에는 <u>옵션별로 주문을 나눠</u> 주세요.</li>
        </ul>
      </div>
    </section>

    <!-- 주문 폼 -->
    <form id="orderForm" class="card" novalidate>
      <div class="inner">
        <h2>주문자 정보</h2>
        <div class="grid">
          <div>
            <label for="buyer">주문자 명 <span style="color:#ef4444">*</span></label>
            <input id="buyer" name="buyer" type="text" placeholder="예: 홍길동">
          </div>
          <div>
            <label for="phone">전화번호 <span style="color:#ef4444">*</span></label>
            <input id="phone" name="phone" type="tel" inputmode="tel" maxlength="13" placeholder="예: 010-1234-5678">
            <div class="subnote">입력 시 자동으로 000-0000-0000 형식으로 변환됩니다.</div>
          </div>
          <div style="grid-column:1/-1">
            <label>집 주소 <span style="color:#ef4444">*</span></label>
            <div class="addr-row">
              <input id="postcode" name="postcode" type="text" placeholder="우편번호" readonly>
              <input id="addr1" name="addr1" type="text" placeholder="도로명 주소" readonly>
              <button type="button" class="btn" id="btnFindAddr">주소 검색</button>
            </div>
            <div style="margin-top:8px">
              <input id="addr2" name="addr2" type="text" placeholder="상세 주소 (동/호수 등)">
            </div>
          </div>
        </div>
      </div>

      <div class="inner" style="border-top:1px solid #f1f5f9; margin-top:8px">
        <h2>옵션 선택</h2>
        <div class="grid">
          <div>
            <label>색상 <span style="color:#ef4444">*</span></label>
            <div class="radios" role="radiogroup" aria-label="색상 선택">
              <label class="radio"><input type="radio" name="color" value="white" checked>흰색</label>
              <label class="radio"><input type="radio" name="color" value="black">검은색</label>
            </div>
          </div>
          <div>
            <label>뒷면 디자인 <span style="color:#ef4444">*</span></label>
            <div class="radios" role="radiogroup" aria-label="뒷면 옵션">
              <label class="radio"><input type="radio" name="back" value="none" checked>없음 (16,000원)</label>
              <label class="radio"><input type="radio" name="back" value="text">텍스트형 (23,000원)</label>
            </div>
          </div>
        </div>

        <!-- 사이즈 정보 (타이틀 + 표) -->
        <div class="size-wrap">
          <h3>사이즈 정보</h3>
          <div class="size-scroll">
            <table class="size-table" aria-label="사이즈 정보 표">
              <thead>
                <tr>
                  <th>Size (cm)</th>
                  <th>S</th><th>M</th><th>L</th><th>XL</th><th>2XL</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>총기장</td><td>66</td><td>70</td><td>74</td><td>77</td><td>81</td></tr>
                <tr><td>어깨너비</td><td>45.5</td><td>48</td><td>50</td><td>53</td><td>55</td></tr>
                <tr><td>가슴너비</td><td>47</td><td>51</td><td>54</td><td>56</td><td>59</td></tr>
                <tr><td>소매길이</td><td>19</td><td>19.5</td><td>21</td><td>23</td><td>25</td></tr>
              </tbody>
            </table>
          </div>
          <div class="size-note">* 측정 방식에 따라 ±2~3cm 오차가 있을 수 있습니다.</div>
        </div>
      </div>

      <div class="inner" style="border-top:1px solid #f1f5f9; margin-top:8px">
        <h2>사이즈별 수량</h2>
        <div class="sizes" id="sizes"><!-- JS로 생성 --></div>
      </div>

      <div class="inner" style="border-top:1px solid #f1f5f9; margin-top:8px">
        <h2>주문 요약</h2>
        <div class="summary" aria-live="polite">
          <div class="line"><span>총 수량</span><b id="sumCount">0장</b></div>
          <div class="line"><span>기본 단가</span><b id="unitPrice">0원</b></div>
          <div class="line"><span>상품 금액</span><b id="subTotal">0원</b></div>
          <div class="line"><span>배송비</span><b id="shipping">0원</b></div>
          <div class="line total"><span>총 결제금액</span><b id="grandTotal">0원</b></div>
        </div>

        <div class="actions">
          <button type="submit" class="btn success lg" id="btnSubmit">주문 제출</button>
          <button type="button" class="btn lg" id="btnReset">초기화</button>
        </div>
        <div id="status"></div>
      </div>
    </form>
  </main>

  <!-- 다음 우편번호 서비스 -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script>
    /* ===== 설정: Apps Script 웹앱 URL ===== */
    const ENDPOINT = 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE'; // ← 스크립트 웹앱 URL로 교체

    /* 이미지 확대 (3배) + 마우스 기준 이동 */
    const media = document.getElementById('media');
    media.addEventListener('click', ()=> media.classList.toggle('zoomed'));
    media.addEventListener('mousemove', (e)=>{
      if(!media.classList.contains('zoomed')) return;
      const img = document.getElementById('prodImg');
      const rect = media.getBoundingClientRect();
      const x = ((e.clientX - rect.left)/rect.width)*100;
      const y = ((e.clientY - rect.top)/rect.height)*100;
      img.style.transformOrigin = x+'% '+y+'%';
    });

    /* 휴대폰 포맷(3-4-4) */
    const phone = document.getElementById('phone');
    const onlyDigits = s => (s||'').replace(/[^\d]/g,'');
    const fmt344 = d => {
      d = onlyDigits(d).slice(0,11);
      if(d.length<=3) return d;
      if(d.length<=7) return d.slice(0,3)+'-'+d.slice(3);
      return d.slice(0,3)+'-'+d.slice(3,7)+'-'+d.slice(7);
    };
    phone.addEventListener('input', ()=>{
      const f = fmt344(phone.value);
      phone.value = f;
      phone.setSelectionRange(f.length, f.length);
    });
    phone.addEventListener('blur', ()=> phone.value = fmt344(phone.value));

    /* 주소 검색 */
    document.getElementById('btnFindAddr').addEventListener('click', ()=>{
      new daum.Postcode({
        oncomplete: function(data) {
          document.getElementById('postcode').value = data.zonecode || '';
          document.getElementById('addr1').value = data.roadAddress || data.jibunAddress || '';
          document.getElementById('addr2').focus();
        }
      }).open();
    });

    /* 사이즈/수량 */
    const SIZES = ['S','M','L','XL','2XL'];
    const sizeWrap = document.getElementById('sizes');
    const counts = Object.fromEntries(SIZES.map(s=>[s,0]));

    function makeSizeBox(size){
      const box = document.createElement('div');
      box.className = 'size-box';
      box.innerHTML = `
        <div class="size-label">${size}</div>
        <div class="stepper">
          <button type="button" aria-label="${size} 수량 감소" data-size="${size}" data-delta="-1">−</button>
          <input type="text" inputmode="numeric" pattern="[0-9]*" value="0" data-size="${size}" aria-label="${size} 수량 입력">
          <button type="button" aria-label="${size} 수량 증가" data-size="${size}" data-delta="1">+</button>
        </div>
      `;
      return box;
    }
    SIZES.forEach(s=> sizeWrap.appendChild(makeSizeBox(s)));

    /* 가격 */
    const PRICE_NONE = 16000;
    const PRICE_TEXT = 23000;
    const SHIPPING = 4000;

    function unitPrice(){
      const v = (document.querySelector('input[name="back"]:checked')||{}).value;
      return v==='text' ? PRICE_TEXT : PRICE_NONE;
    }
    function totalCount(){
      return SIZES.reduce((acc,s)=> acc + (counts[s]||0), 0);
    }
    function recalc(){
      const cnt = totalCount();
      const unit = unitPrice();
      const subtotal = unit * cnt;
      const ship = cnt>0 ? SHIPPING : 0;
      const total = subtotal + ship;
      const fmt = n => n.toLocaleString('ko-KR');

      document.getElementById('sumCount').textContent = `${cnt}장`;
      document.getElementById('unitPrice').textContent = `${fmt(unit)}원`;
      document.getElementById('subTotal').textContent = `${fmt(subtotal)}원`;
      document.getElementById('shipping').textContent = `${fmt(ship)}원`;
      document.getElementById('grandTotal').textContent = `${fmt(total)}원`;
    }
    recalc();

    sizeWrap.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-size]');
      if(!btn) return;
      const size = btn.dataset.size;
      const delta = parseInt(btn.dataset.delta,10);
      const input = sizeWrap.querySelector(`input[data-size="${size}"]`);
      let v = parseInt(input.value||'0',10); if(isNaN(v)) v=0;
      v = Math.max(0, v + delta);
      input.value = v;
      counts[size] = v;
      recalc();
    });
    sizeWrap.addEventListener('input', (e)=>{
      const ip = e.target.closest('input[data-size]');
      if(!ip) return;
      let v = parseInt(onlyDigits(ip.value)||'0',10); if(isNaN(v)) v=0;
      ip.value = v;
      counts[ip.dataset.size] = v;
      recalc();
    });
    document.querySelectorAll('input[name="back"]').forEach(r=>{
      r.addEventListener('change', recalc);
    });

    /* 제출/초기화 */
    const statusEl = document.getElementById('status');
    const showErr = msg => statusEl.innerHTML = `<span class="notice notice-err">${msg}</span>`;
    const showOk  = msg => statusEl.innerHTML = `<span class="notice notice-ok">${msg}</span>`;

    document.getElementById('btnReset').addEventListener('click', ()=>{
      document.getElementById('orderForm').reset();
      SIZES.forEach(s=>{
        counts[s]=0;
        const ip = sizeWrap.querySelector(`input[data-size="${s}"]`); if(ip) ip.value = 0;
      });
      recalc();
      ['buyer','phone','postcode','addr1'].forEach(id=> document.getElementById(id).classList.remove('invalid'));
      statusEl.textContent='';
    });

    function validate(){
      let errs=[];
      const buyer = document.getElementById('buyer');
      const phone = document.getElementById('phone');
      const postcode = document.getElementById('postcode');
      const addr1 = document.getElementById('addr1');

      [buyer,phone,postcode,addr1].forEach(i=> i.classList.remove('invalid'));

      if(!buyer.value.trim()){ errs.push('주문자 명'); buyer.classList.add('invalid'); }
      const d = (phone.value||'').replace(/[^\d]/g,''); if(d.length!==11){ errs.push('전화번호(11자리)'); phone.classList.add('invalid'); }
      if(!postcode.value.trim()){ errs.push('우편번호'); postcode.classList.add('invalid'); }
      if(!addr1.value.trim()){ errs.push('주소'); addr1.classList.add('invalid'); }
      if(totalCount()===0){ errs.push('주문 수량'); }

      if(errs.length){
        alert('다음 항목을 확인하세요:\n- ' + errs.join('\n- '));
        return false;
      }
      return true;
    }

    function buildForm(){
      const fd = new FormData();
      fd.set('ts', new Date().toISOString());
      fd.set('buyer', document.getElementById('buyer').value.trim());
      fd.set('phone', document.getElementById('phone').value.trim());
      fd.set('postcode', document.getElementById('postcode').value.trim());
      fd.set('addr1', document.getElementById('addr1').value.trim());
      fd.set('addr2', document.getElementById('addr2').value.trim());
      fd.set('color', (document.querySelector('input[name="color"]:checked')||{}).value || '');
      fd.set('back', (document.querySelector('input[name="back"]:checked')||{}).value || '');

      ['S','M','L','XL','2XL'].forEach(s=> fd.set(`qty_${s}`, counts[s]||0));
      const cnt = totalCount();
      fd.set('qty_total', cnt);

      const unit = (document.querySelector('input[name="back"]:checked')||{}).value==='text' ? 23000 : 16000;
      const subtotal = unit * cnt;
      const shipping = cnt>0 ? 4000 : 0;
      const total = subtotal + shipping;

      fd.set('unit_price', unit);
      fd.set('subtotal', subtotal);
      fd.set('shipping', shipping);
      fd.set('total', total);
      return fd;
    }

    document.getElementById('orderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      statusEl.textContent='';
      if(!validate()) return;

      const btn = document.getElementById('btnSubmit');
      btn.disabled = true; btn.textContent = '전송 중…';

      try{
        if(!ENDPOINT || ENDPOINT.startsWith('YOUR_')) throw new Error('endpoint not set');
        const res = await fetch(ENDPOINT, { method:'POST', body: buildForm() });
        const data = await res.json().catch(()=>({ok:res.ok}));
        if(res.ok && (data.ok===true || data.status==='ok')){
          showOk('주문이 접수되었습니다. 감사합니다!');
          alert('주문이 접수되었습니다. 감사합니다!');
          document.getElementById('btnReset').click();
        }else{
          console.error('server resp:', data);
          showErr('서버 응답 오류가 발생했습니다.');
          alert('서버 응답 오류가 발생했습니다.');
        }
      }catch(err){
        console.error(err);
        if(String(err.message).includes('endpoint')){
          showErr('관리자: ENDPOINT(웹앱 URL)를 설정해 주세요.');
          alert('관리자: ENDPOINT(웹앱 URL)를 설정해 주세요.');
        }else{
          showErr('네트워크 오류가 발생했습니다.');
          alert('네트워크 오류가 발생했습니다.');
        }
      }finally{
        btn.disabled = false; btn.textContent = '주문 제출';
      }
    });
  </script>
</body>
</html>
