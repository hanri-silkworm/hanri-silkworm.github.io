<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ›ëˆ„ëˆ„ ìºë¦­í„° í‹°ì…”ì¸  ì£¼ë¬¸</title>
  <style>
    :root{
      --bg:#ffffff; --paper:#ffffff; --ink:#111827; --sub:#6b7280;
      --pri:#4b5563; --muted:#e5e7eb; --ring:rgba(107,114,128,.25);
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --green:#059669; --blue:#1e3a8a; --danger:#ef4444;
      --amber:#b45309; --gray:#f3f4f6;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:20px 16px}

    /* NAV */
    header.nav{position:sticky;top:0;backdrop-filter:saturate(180%) blur(8px);background:rgba(247,246,243,.75);border-bottom:1px solid var(--muted);z-index:50}
    .nav-inner{display:flex;align-items:center;justify-content:flex-end;gap:12px;padding:10px 16px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:9px 12px;border-radius:999px;border:1px solid var(--muted);
      background:var(--paper);color:var(--ink);text-decoration:none;font-weight:600;
    }
    .btn.primary{background:var(--pri);color:#fff;border:0}
    .btn.success{background:var(--green);color:#fff;border:0}
    .btn:hover{box-shadow:0 6px 18px rgba(15,23,42,.08)}
    .btn.lg{font-size:16px; padding:10px 18px; min-height:42px; min-width:140px}
    @media (min-width:768px){ .btn.lg{font-size:17px; padding:12px 22px; min-width:180px} }

    /* ì¹´ë“œ */
    .card{background:var(--paper);border:1px solid var(--muted);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    .card .inner{padding:16px}
    .card + .card{margin-top:18px}            /* ì„¹ì…˜ ê°„ ê¸°ë³¸ ê°„ê²© */

    /* íˆì–´ë¡œ */
    .hero{margin:16px auto;border-radius:20px}
    .p-hero{display:flex;flex-direction:column;gap:12px}
    .p-hero h1{margin:0;font-size:clamp(22px,4vw,30px);letter-spacing:-.2px}
    .p-hero .lead{margin:0;color:var(--sub)}
    .media{
      position:relative; border:1px solid var(--muted); border-radius:14px; overflow:hidden; background:#f3f4f6;
      cursor: zoom-in;
    }
    .media img{ display:block; width:100%; height:auto; transform-origin:center center; transition:transform .18s ease; }
    .media.zoomed{ cursor: zoom-out; }
    .media.zoomed img{ transform: scale(3); } /* 3ë°° í™•ëŒ€ */
    .zoom-hint{ position:absolute; right:10px; bottom:10px; background:rgba(17,24,39,.6); color:#fff; font-size:12px; padding:6px 8px; border-radius:999px; }

    .bullets{margin:8px 0 0; padding-left:18px; color:#374151}
    .bullets li{margin:4px 0}

    /* ê³µì§€ ë°•ìŠ¤ */
    .notice{ background:linear-gradient(180deg,#f3f4f6 0%,#fff 100%); border:1px solid var(--muted); border-left:4px solid #cbd5e1; border-radius:14px; margin-bottom:22px } /* â† ê°„ê²© ì¶”ê°€ */
    .notice .inner{ padding:14px 16px; }
    .notice h3{ margin:0 0 6px; font-size:18px; }
    .notice ul{ margin:6px 0 0; padding-left:18px; }
    .notice li{ margin:4px 0; }

    /* ì…ë ¥ ê³µí†µ */
    h2{margin:0 0 8px;font-size:20px}
    h3{margin:10px 0 8px; font-size:18px}
    label{font-weight:700;display:block;margin-bottom:6px}
    .subnote{color:var(--sub);font-size:12px;margin-top:4px}
    input[type="text"], input[type="tel"]{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--muted); outline:none; background:#fff;
    }
    input[type="text"]:focus, input[type="tel"]:focus{box-shadow:0 0 0 3px var(--ring)}
    input.invalid{border-color:#fca5a5; box-shadow:0 0 0 2px rgba(239,68,68,.2)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:760px){ .grid{grid-template-columns:1fr} }

    .addr-row{display:grid; grid-template-columns:130px 1fr auto; gap:8px}
    .addr-row .btn{white-space:nowrap}
    @media (max-width:560px){ .addr-row{grid-template-columns:1fr 1fr} .addr-row .btn{grid-column:1/3} }

    .radios{display:flex;gap:10px;flex-wrap:wrap}
    .radio{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--muted); border-radius:999px; background:#fff; cursor:pointer; user-select:none }
    .radio input{accent-color:#2563eb}

    /* ì‚¬ì´ì¦ˆ ì •ë³´ í‘œ */
    .size-wrap{margin-top:12px}
    .size-scroll{overflow:auto; -webkit-overflow-scrolling:touch}
    .size-table{
      width:100%; min-width: 640px; border-collapse:separate; border-spacing:0; border:1px solid var(--muted);
      border-radius:12px; overflow:hidden; background:#fff; table-layout:fixed;
    }
    .size-table th, .size-table td{
      padding:10px 12px; border-bottom:1px solid #f1f5f9; text-align:center; white-space:nowrap
    }
    .size-table thead th{background:#f8fafc; color:#334155}
    .size-table th:first-child, .size-table td:first-child{min-width: 120px;}
    .size-table th:not(:first-child), .size-table td:not(:first-child){min-width: 80px;}
    @media (max-width:560px){ .size-table th, .size-table td{ padding:8px 10px; font-size:14px; } }
    .size-note{color:var(--sub); font-size:12px; margin-top:6px}

    /* ì‚¬ì´ì¦ˆë³„ ìˆ˜ëŸ‰ */
    .sizes{display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:10px}
    .size-box{ border:1px solid var(--muted); border-radius:12px; padding:12px; background:#fff; display:flex; align-items:center; justify-content:space-between; gap:10px; min-width:0; }
    .size-label{font-weight:800; white-space:nowrap}
    .stepper{display:flex; align-items:center; justify-content:center; gap:6px}
    .stepper button{ width:44px; height:44px; border-radius:10px; border:1px solid var(--muted); background:#fff; font-size:20px; line-height:1; cursor:pointer; }
    .stepper input{ width:64px; text-align:center; padding:10px; border-radius:10px; border:1px solid var(--muted); background:#fff; font-size:16px; }
    @media (max-width: 720px){ .sizes{ grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); } .stepper button{ width:40px; height:40px; } .stepper input{ width:56px; padding:8px; } }
    @media (max-width: 400px){ .sizes{ grid-template-columns: 1fr; } .stepper button{ width:38px; height:38px; } .stepper input{ width:52px; padding:8px; } }

    /* ìš”ì•½/ê°€ê²© */
    .summary{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .summary .line{
      display:flex; align-items:center; justify-content:space-between;
      border:1px solid var(--muted); border-radius:10px; padding:10px 12px; background:#fff;
      min-width:0;
    }
    .summary .line span{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex:1; margin-right:10px; }
    .summary .line b{ white-space:nowrap; flex:0 0 auto; }
    .summary .total{grid-column:1/-1; font-weight:900; font-size:18px; color:#111827; border-color:#cbd5e1}
    @media (max-width:560px){ .summary{ grid-template-columns:1fr; } .summary .line{ font-size:15px; } }

    .actions{display:flex;gap:12px;justify-content:center;margin-top:14px} /* â† ë²„íŠ¼ ìœ„ ê°„ê²© ì‚´ì§ í‚¤ì›€ */
    #status{min-height:24px;text-align:center;margin-top:6px}
    .notice-text{font-weight:700}
    .notice-ok{color:#065f46}
    .notice-err{color:#b91c1c}
  </style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner wrap">
      <a class="btn" href="index.html">Home</a>
    </div>
  </header>

  <main class="wrap">
    <!-- íˆì–´ë¡œ -->
    <section class="card hero">
      <div class="inner p-hero">
        <div class="media" id="media">
          <img src="https://www.hanri.net/nunu/nunu_tshirt_image.png" alt="ëˆ„ëˆ„ ìºë¦­í„° í‹°ì…”ì¸ " id="prodImg">
          <span class="zoom-hint">íƒ­/í´ë¦­ ì‹œ í¬ê²Œ ë³´ê¸°</span>
        </div>
        <h1>ğŸ›ëˆ„ëˆ„ ìºë¦­í„° í‹°ì…”ì¸ </h1>
        <p class="lead">
          ê·€ì—¬ìš´ ëˆ„ì—ì™€ í•˜ë£¨ë¥¼ í•¨ê»˜ ì‹œì‘í•´ë³´ì„¸ìš”! ë¶€ë“œëŸ¬ìš´ ì½”íŠ¼ ì›ë‹¨ì— ê·€ì—¬ìš´ ëˆ„ì—ë¥¼ ë”í•œ ë°ì¼ë¦¬ í‹°ì…”ì¸ ì…ë‹ˆë‹¤.
          í°ìƒ‰/ê²€ì€ìƒ‰ 2ê°€ì§€ ìƒ‰ìƒê³¼ ë’·ë©´ ì˜µì…˜ ì—†ìŒÂ·í…ìŠ¤íŠ¸í˜• ì¤‘ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤. ëˆ„ì—ì—¥~
        </p>
        <ul class="bullets">
          <li><b>ì†Œì¬</b>: ë©´ 100%</li>
          <li><b>ì œì¡°ì‚¬/ì œì¡°êµ­</b>: Printstar / Made in China</li>
          <li><b>í•</b>: ì •ì‚¬ì´ì¦ˆ(ë‚¨ë…€ê³µìš©) Â· <b>ì‹ ì¶•ì„±</b>: ì¢‹ìŒ Â· <b>ê°ì´‰</b>: ë¶€ë“œëŸ¬ì›€ Â· <b>ë‘ê»˜</b>: ë„í†° (17ìˆ˜)</li>
          <li><b>ë’·ë©´ ì˜µì…˜</b>: ì—†ìŒ <b>18,000ì›</b> / í…ìŠ¤íŠ¸í˜• <b>26,000ì›</b> (ì§€ê¸ˆ í‘œì‹œëœ ê¸ˆì•¡ì€ ìµœëŒ€ ì²­êµ¬ì•¡ì…ë‹ˆë‹¤. ìµœì¢… ë‹¨ê°€ê°€ ë” ë‚®ê²Œ í™•ì •ë˜ë©´ ìë™ í™˜ë¶ˆë©ë‹ˆë‹¤.)</li>
          <li><b>ë°°ì†¡ë¹„</b>: 4,000ì›</li>
          <li><b>ì…ê¸ˆ ê³„ì¢Œ</b>: í•œë¦¬ ë†í˜‘ 302-1235-6391-61 / 010-4044-0220</li>
          <li style="color:#b45309"><b>ì•ˆë‚´</b>: ì˜µì…˜ì´ ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” <u>ì˜µì…˜ë³„ë¡œ ì£¼ë¬¸ì„ ë‚˜ëˆ </u> ì£¼ì„¸ìš”.</li>
        </ul>
      </div>
    </section>

    <!-- ì‹ ì²­/ì œì‘/ë°°ì†¡ ê³µì§€ -->
    <section class="card notice" aria-labelledby="schedule-title">
      <div class="inner">
        <h3 id="schedule-title">ì‹ ì²­Â·ì œì‘Â·ë°°ì†¡ ì•ˆë‚´</h3>
        <ul>
          <li><b>ì‹ ì²­(ì…ê¸ˆ) ê¸°ê°„</b> : <u>9ì›” 9ì¼ ~ 9ì›” 11ì¼</u> (3ì¼) / ê¸°í•œë‚´ ë¯¸ì…ê¸ˆì‹œ ìë™ ì·¨ì†Œë©ë‹ˆë‹¤.</li>
          <li><b>ì£¼ë¬¸(ì œì‘) ì˜ˆì •ì¼</b> : <u>9ì›” 12ì¼</u></li>
          <li><b>ë°°ì†¡ ì¼ì •</b> : ì œì‘ì‚¬ ì¸¡ í‹°ì…”ì¸  ìˆ˜ë ¹ í›„ ë°œì†¡ Â· <u>ë‹¤ìŒ ì£¼(9ì›” 16ì¼ ~ 19ì¼)</u> ì¤‘ ë°°ì†¡</li>
        </ul>
      </div>
    </section>

    <!-- ì£¼ë¬¸ í¼ -->
    <form id="orderForm" class="card" novalidate>
      <div class="inner">
        <h2>ì£¼ë¬¸ì ì •ë³´</h2>
        <div class="grid">
          <div>
            <label for="buyer">ì£¼ë¬¸ì ëª… <span style="color:#ef4444">*</span></label>
            <input id="buyer" name="buyer" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™">
          </div>
          <div>
            <label for="phone">ì „í™”ë²ˆí˜¸ <span style="color:#ef4444">*</span></label>
            <input id="phone" name="phone" type="tel" inputmode="tel" maxlength="13" placeholder="ì˜ˆ: 010-1234-5678">
            <div class="subnote">ì…ë ¥ ì‹œ ìë™ìœ¼ë¡œ 000-0000-0000 í˜•ì‹ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.</div>
          </div>
          <div style="grid-column:1/-1">
            <label>ì§‘ ì£¼ì†Œ <span style="color:#ef4444">*</span></label>
            <div class="addr-row">
              <input id="postcode" name="postcode" type="text" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
              <input id="addr1" name="addr1" type="text" placeholder="ë„ë¡œëª… ì£¼ì†Œ" readonly>
              <button type="button" class="btn" id="btnFindAddr">ì£¼ì†Œ ê²€ìƒ‰</button>
            </div>
            <div style="margin-top:8px">
              <input id="addr2" name="addr2" type="text" placeholder="ìƒì„¸ ì£¼ì†Œ (ë™/í˜¸ìˆ˜ ë“±)">
            </div>
          </div>
        </div>
      </div>

      <div class="inner" style="border-top:1px solid #f1f5f9; margin-top:8px">
        <h2>ì˜µì…˜ ì„ íƒ</h2>
        <div class="grid">
          <div>
            <label>ìƒ‰ìƒ <span style="color:#ef4444">*</span></label>
            <div class="radios" role="radiogroup" aria-label="ìƒ‰ìƒ ì„ íƒ">
              <label class="radio"><input type="radio" name="color" value="white" checked>í°ìƒ‰</label>
              <label class="radio"><input type="radio" name="color" value="black">ê²€ì€ìƒ‰</label>
            </div>
          </div>
          <div>
            <label>ë’·ë©´ ë””ìì¸ <span style="color:#ef4444">*</span></label>
            <div class="radios" role="radiogroup" aria-label="ë’·ë©´ ì˜µì…˜">
              <label class="radio"><input type="radio" name="back" value="none" checked>ì—†ìŒ (18,000ì›)</label>
              <label class="radio"><input type="radio" name="back" value="text">í…ìŠ¤íŠ¸í˜• (26,000ì›)</label>
            </div>
          </div>
        </div>

        <!-- ì‚¬ì´ì¦ˆ ì •ë³´ -->
        <div class="size-wrap">
          <h3>ì‚¬ì´ì¦ˆ ì •ë³´</h3>
          <div class="size-scroll">
            <table class="size-table" aria-label="ì‚¬ì´ì¦ˆ ì •ë³´ í‘œ">
              <thead>
                <tr>
                  <th>Size (cm)</th>
                  <th>S</th><th>M</th><th>L</th><th>XL</th><th>2XL</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>ì´ê¸°ì¥</td><td>66</td><td>70</td><td>74</td><td>77</td><td>81</td></tr>
                <tr><td>ì–´ê¹¨ë„ˆë¹„</td><td>45.5</td><td>48</td><td>50</td><td>53</td><td>55</td></tr>
                <tr><td>ê°€ìŠ´ë„ˆë¹„</td><td>47</td><td>51</td><td>54</td><td>56</td><td>59</td></tr>
                <tr><td>ì†Œë§¤ê¸¸ì´</td><td>19</td><td>19.5</td><td>21</td><td>23</td><td>25</td></tr>
              </tbody>
            </table>
          </div>
          <div class="size-note">* ì¸¡ì • ë°©ì‹ì— ë”°ë¼ Â±2~3cm ì˜¤ì°¨ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        </div>
      </div>

      <div class="inner" style="border-top:1px solid #f1f5f9; margin-top:8px">
        <h2>ì‚¬ì´ì¦ˆë³„ ìˆ˜ëŸ‰</h2>
        <div class="sizes" id="sizes"></div>
      </div>

      <div class="inner" style="border-top:1px solid #f1f5f9; margin-top:8px">
        <h2>ì£¼ë¬¸ ìš”ì•½</h2>
        <div class="summary" aria-live="polite">
          <div class="line"><span>ì´ ìˆ˜ëŸ‰</span><b id="sumCount">0ì¥</b></div>
          <div class="line"><span>ê¸°ë³¸ ë‹¨ê°€</span><b id="unitPrice">0ì›</b></div>
          <div class="line"><span>ìƒí’ˆ ê¸ˆì•¡</span><b id="subTotal">0ì›</b></div>
          <div class="line"><span>ë°°ì†¡ë¹„</span><b id="shipping">0ì›</b></div>
          <div class="line total"><span>ì´ ê²°ì œê¸ˆì•¡</span><b id="grandTotal">0ì›</b></div>
        </div>

        <div class="actions">
          <button type="submit" class="btn success lg" id="btnSubmit">ì£¼ë¬¸ ì œì¶œ</button>
          <button type="button" class="btn lg" id="btnReset">ì´ˆê¸°í™”</button>
        </div>
        <div id="status"></div>
      </div>
    </form>
  </main>

  <!-- ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ ì„œë¹„ìŠ¤ -->
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script>
    /* ===== Apps Script ì›¹ì•± URL ===== */
    const ENDPOINT = 'https://script.google.com/macros/s/AKfycbyqanYN6k_qWKwKzx3iGyAkVdXHewclHKKVFhadpzBKc4CmfO9PxkvfCpXUuGodhCFpAQ/exec';


    /* ì´ë¯¸ì§€ í™•ëŒ€ */
    const media = document.getElementById('media');
    media.addEventListener('click', ()=> media.classList.toggle('zoomed'));
    media.addEventListener('mousemove', (e)=>{
      if(!media.classList.contains('zoomed')) return;
      const img = document.getElementById('prodImg');
      const rect = media.getBoundingClientRect();
      const x = ((e.clientX - rect.left)/rect.width)*100;
      const y = ((e.clientY - rect.top)/rect.height)*100;
      img.style.transformOrigin = x+'% '+y+'%';
    });

    /* íœ´ëŒ€í° í¬ë§·(3-4-4) */
    const phone = document.getElementById('phone');
    const onlyDigits = s => (s||'').replace(/[^\d]/g,'');
    const fmt344 = d => {
      d = onlyDigits(d).slice(0,11);
      if(d.length<=3) return d;
      if(d.length<=7) return d.slice(0,3)+'-'+d.slice(3);
      return d.slice(0,3)+'-'+d.slice(3,7)+'-'+d.slice(7);
    };
    phone.addEventListener('input', ()=>{
      const f = fmt344(phone.value);
      phone.value = f;
      phone.setSelectionRange(f.length, f.length);
    });
    phone.addEventListener('blur', ()=> phone.value = fmt344(phone.value));

    /* ì£¼ì†Œ ê²€ìƒ‰ */
    document.getElementById('btnFindAddr').addEventListener('click', ()=>{
      new daum.Postcode({
        oncomplete: function(data) {
          document.getElementById('postcode').value = data.zonecode || '';
          document.getElementById('addr1').value = data.roadAddress || data.jibunAddress || '';
          document.getElementById('addr2').focus();
        }
      }).open();
    });

    /* ì‚¬ì´ì¦ˆ/ìˆ˜ëŸ‰ */
    const SIZES = ['S','M','L','XL','2XL'];
    const sizeWrap = document.getElementById('sizes');
    const counts = Object.fromEntries(SIZES.map(s=>[s,0]));

    function makeSizeBox(size){
      const box = document.createElement('div');
      box.className = 'size-box';
      box.innerHTML = `
        <div class="size-label">${size}</div>
        <div class="stepper">
          <button type="button" aria-label="${size} ìˆ˜ëŸ‰ ê°ì†Œ" data-size="${size}" data-delta="-1">âˆ’</button>
          <input type="text" inputmode="numeric" pattern="[0-9]*" value="0" data-size="${size}" aria-label="${size} ìˆ˜ëŸ‰ ì…ë ¥">
          <button type="button" aria-label="${size} ìˆ˜ëŸ‰ ì¦ê°€" data-size="${size}" data-delta="1">+</button>
        </div>
      `;
      return box;
    }
    SIZES.forEach(s=> sizeWrap.appendChild(makeSizeBox(s)));

    /* ê°€ê²© */
    const PRICE_NONE = 18000;
    const PRICE_TEXT = 26000;
    const SHIPPING = 4000;

    function unitPrice(){
      const v = (document.querySelector('input[name="back"]:checked')||{}).value;
      return v==='text' ? PRICE_TEXT : PRICE_NONE;
    }
    function totalCount(){ return SIZES.reduce((acc,s)=> acc + (counts[s]||0), 0); }
    function recalc(){
      const cnt = totalCount();
      const unit = unitPrice();
      const subtotal = unit * cnt;
      const ship = cnt>0 ? SHIPPING : 0;
      const total = subtotal + ship;
      const fmt = n => n.toLocaleString('ko-KR');
      document.getElementById('sumCount').textContent = `${cnt}ì¥`;
      document.getElementById('unitPrice').textContent = `${fmt(unit)}ì›`;
      document.getElementById('subTotal').textContent = `${fmt(subtotal)}ì›`;
      document.getElementById('shipping').textContent = `${fmt(ship)}ì›`;
      document.getElementById('grandTotal').textContent = `${fmt(total)}ì›`;
    }
    recalc();

    sizeWrap.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-size]');
      if(!btn) return;
      const size = btn.dataset.size;
      const delta = parseInt(btn.dataset.delta,10);
      const input = sizeWrap.querySelector(`input[data-size="${size}"]`);
      let v = parseInt(input.value||'0',10); if(isNaN(v)) v=0;
      v = Math.max(0, v + delta);
      input.value = v; counts[size] = v; recalc();
    });
    sizeWrap.addEventListener('input', (e)=>{
      const ip = e.target.closest('input[data-size]'); if(!ip) return;
      let v = parseInt(onlyDigits(ip.value)||'0',10); if(isNaN(v)) v=0;
      ip.value = v; counts[ip.dataset.size] = v; recalc();
    });
    document.querySelectorAll('input[name="back"]').forEach(r=> r.addEventListener('change', recalc));

    /* ì œì¶œ/ì´ˆê¸°í™” */
    const statusEl = document.getElementById('status');
    const showErr = msg => statusEl.innerHTML = `<span class="notice-text notice-err">${msg}</span>`;
    const showOk  = msg => statusEl.innerHTML = `<span class="notice-text notice-ok">${msg}</span>`;

    function validate(){
      let errs=[];
      const buyer = document.getElementById('buyer');
      const phone = document.getElementById('phone');
      const postcode = document.getElementById('postcode');
      const addr1 = document.getElementById('addr1');

      [buyer,phone,postcode,addr1].forEach(i=> i.classList.remove('invalid'));

      if(!buyer.value.trim()){ errs.push('ì£¼ë¬¸ì ëª…'); buyer.classList.add('invalid'); }
      const d = (phone.value||'').replace(/[^\d]/g,''); if(d.length!==11){ errs.push('ì „í™”ë²ˆí˜¸(11ìë¦¬)'); phone.classList.add('invalid'); }
      if(!postcode.value.trim()){ errs.push('ìš°í¸ë²ˆí˜¸'); postcode.classList.add('invalid'); }
      if(!addr1.value.trim()){ errs.push('ì£¼ì†Œ'); addr1.classList.add('invalid'); }
      if(SIZES.every(s=> (counts[s]||0)===0)){ errs.push('ì£¼ë¬¸ ìˆ˜ëŸ‰'); }

      if(errs.length){
        alert('ë‹¤ìŒ í•­ëª©ì„ í™•ì¸í•˜ì„¸ìš”:\n- ' + errs.join('\n- '));
        return false;
      }
      return true;
    }

    function buildForm(){
      const fd = new FormData();
      fd.set('ts', new Date().toISOString());
      fd.set('buyer', document.getElementById('buyer').value.trim());
      fd.set('phone', document.getElementById('phone').value.trim());
      fd.set('postcode', document.getElementById('postcode').value.trim());
      fd.set('addr1', document.getElementById('addr1').value.trim());
      fd.set('addr2', document.getElementById('addr2').value.trim());
      fd.set('color', (document.querySelector('input[name="color"]:checked')||{}).value || '');
      fd.set('back', (document.querySelector('input[name="back"]:checked')||{}).value || '');
      ['S','M','L','XL','2XL'].forEach(s=> fd.set(`qty_${s}`, counts[s]||0));
      const cnt = ['S','M','L','XL','2XL'].reduce((a,s)=>a+(counts[s]||0),0);
      const unit = (document.querySelector('input[name="back"]:checked')||{}).value==='text' ? 26000 : 18000;
      const subtotal = unit * cnt; const shipping = cnt>0 ? 4000 : 0; const total = subtotal + shipping;
      fd.set('qty_total', cnt);
      fd.set('unit_price', unit); fd.set('subtotal', subtotal); fd.set('shipping', shipping); fd.set('total', total);
      return fd;
    }

    document.getElementById('btnReset').addEventListener('click', ()=>{
      document.getElementById('orderForm').reset();
      ['S','M','L','XL','2XL'].forEach(s=>{
        counts[s]=0;
        const ip = sizeWrap.querySelector(`input[data-size="${s}"]`); if(ip) ip.value = 0;
      });
      recalc();
      ['buyer','phone','postcode','addr1'].forEach(id=> document.getElementById(id).classList.remove('invalid'));
      statusEl.textContent='';
    });

    document.getElementById('orderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      statusEl.textContent='';
      if(!validate()) return;

      const btn = document.getElementById('btnSubmit');
      btn.disabled = true; btn.textContent = 'ì „ì†¡ ì¤‘â€¦';

      try{
        const res = await fetch(ENDPOINT, { method:'POST', body: buildForm() });

        // ---- ì‘ë‹µ ê´€ëŒ€ ì²˜ë¦¬: 2xxë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼, JSON ì—†ìœ¼ë©´ ë³¸ë¬¸ í…ìŠ¤íŠ¸ ê²€ì‚¬ ----
        const text = await res.text().catch(()=> '');
        let data = null;
        try{ data = text ? JSON.parse(text) : null; }catch(_){}
        const ok2xx = res.ok;
        const looksOk = data?.ok === true || data?.status === 'ok' || /ok|success/i.test(text||'');
        if(ok2xx && (looksOk || !data)) {
          showOk('ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
          alert('ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!');
          document.getElementById('btnReset').click();
        }else{
          console.error('Server response:', {status: res.status, text});
          showErr('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          alert('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      }catch(err){
        console.error(err);
        showErr('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }finally{
        btn.disabled = false; btn.textContent = 'ì£¼ë¬¸ ì œì¶œ';
      }
    });
  </script>
</body>
</html>
