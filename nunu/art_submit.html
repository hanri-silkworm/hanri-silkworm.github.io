<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ëˆ„ì— ê·¸ë¦¼ ëŒ€íšŒ â€” ì‘í’ˆ ì œì¶œ</title>
  <meta name="description" content="ëˆ„ì— ê·¸ë¦¼ ê·¸ë¦¬ê¸° ëŒ€íšŒ ì‘í’ˆ ì œì¶œ í˜ì´ì§€" />
  <style>
    :root{
      --bg:#ffffff; --paper:#ffffff; --ink:#111827; --sub:#6b7280;
      --pri:#4b5563; --pri-2:#374151; --muted:#e5e7eb; --ring:rgba(107,114,128,.25);
      --radius:16px; --shadow:0 10px 30px rgba(17,24,39,.08); --wrap:1100px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif}
    .wrap{max-width:var(--wrap);margin:0 auto;padding:24px}
    header.nav{position:sticky;top:0;backdrop-filter:saturate(180%) blur(8px);
      background:rgba(247,246,243,.8);border-bottom:1px solid var(--muted);z-index:50}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 18px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    .brand strong{font-weight:800;letter-spacing:.2px}

    main .card{background:var(--paper);border:1px solid var(--muted);
      border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .section-title{margin:0 0 10px;font-size:20px}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:700px){.row{grid-template-columns:1fr 1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:14px;font-weight:800}
    .field input,.field textarea{
      border:1px solid #d1d5db;border-radius:12px;padding:12px;font-size:15px}
    .field textarea{min-height:110px;resize:vertical}
    .hint{color:var(--sub);font-size:13px;margin:6px 0 0}
    .toolbar{margin-top:14px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .btn.submit{border:0;border-radius:12px;font-weight:800;padding:12px 16px;cursor:pointer;background:#111827;color:#fff;font-size:15px}
    .btn.submit[disabled]{opacity:.5;cursor:not-allowed}
    .notice{font-size:14px;margin:8px 0 0}
    .success{color:#065f46}.error{color:#b91c1c}

    /* íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° */
    .preview{margin-top:8px;border:1px dashed #d1d5db;border-radius:12px;padding:10px;background:#fafafa}
    .preview small{color:#6b7280}
    .thumb{margin-top:8px;max-height:260px;overflow:hidden;border-radius:10px}
    .thumb img{width:100%;height:auto;object-fit:contain}

    /* Toast */
    #toast{position:fixed;inset:auto 16px 16px auto;background:#111;color:#fff;
      padding:10px 14px;border-radius:10px;font-size:13px;opacity:0;transform:translateY(8px);transition:all .25s ease}
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="nav-inner wrap">
      <a class="brand" href="#" aria-label="ëˆ„ì— ëŒ€íšŒ í™ˆ"><strong>ğŸ› ëˆ„ì— ê·¸ë¦¼ ëŒ€íšŒ</strong></a>
    </div>
  </header>

  <!-- FORM -->
  <main class="wrap">
    <section class="card" aria-labelledby="form-title">
      <h2 id="form-title" class="section-title">ì‘í’ˆ ì œì¶œ</h2>
      <p class="hint">ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê·¸ë¦¼ íŒŒì¼ì„ ì²¨ë¶€í•œë‹¤. â€œë³´ë‚´ê¸°â€ë¥¼ ëˆ„ë¥´ë©´ ì£¼ìµœ ì¸¡ ì´ë©”ì¼ë¡œ ì „ì†¡í•œë‹¤.</p>

      <form id="submitForm" novalidate>
        <div class="row">
          <div class="field">
            <label for="artistName">ì°¸ê°€ì ì´ë¦„/ë‹‰ë„¤ì„</label>
            <input id="artistName" name="name" type="text" autocomplete="name" required placeholder="ì˜ˆ: í•œë¦¬ / Hanri" />
          </div>
          <div class="field">
            <label for="artistContact">ì—°ë½ ìˆ˜ë‹¨(ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸)</label>
            <input id="artistContact" name="contact" type="text" required placeholder="ì˜ˆ: hanri@example.com ë˜ëŠ” 010-1234-5678" />
            <p class="hint">ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ ì¤‘ í•˜ë‚˜ë§Œ ì ì–´ë„ ëœë‹¤.</p>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="artTitle">ì‘í’ˆ ì œëª©</label>
            <input id="artTitle" name="title" type="text" required placeholder="ì˜ˆ: ë‹¨í’ ì†ì˜ ëˆ„ì—" />
          </div>
          <div class="field">
            <label for="artFile">ì‘í’ˆ ì²¨ë¶€</label>
            <input id="artFile" name="files" type="file" accept="image/*" required />
            <div id="filePreview" class="preview" hidden>
              <div><b id="fileName"></b> <small id="fileMeta"></small></div>
              <div class="thumb"><img id="fileImg" alt="ì²¨ë¶€ ê·¸ë¦¼ ë¯¸ë¦¬ë³´ê¸°" /></div>
              <small>ìµœëŒ€ 10MB, ì´ë¯¸ì§€ 1ê°œ.</small>
            </div>
          </div>
        </div>

        <div class="field">
          <label for="artDesc">ì‘í’ˆ ì„¤ëª…(ì„ íƒ)</label>
          <textarea id="artDesc" name="desc" maxlength="500" placeholder="ì‘í’ˆ ì˜ë„Â·ì„¤ëª…(ìµœëŒ€ 500ì)"></textarea>
        </div>

        <div class="toolbar">
          <div class="hint">ê°œì¸ì •ë³´ ì²˜ë¦¬: ìˆ˜ì§‘ í•­ëª©ì€ ì´ë¦„/ì—°ë½ì²˜/ì‘í’ˆ ì œëª©/ì„¤ëª…/ì´ë¯¸ì§€ì´ë©°, ì‹¬ì‚¬Â·ì—°ë½ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ê³  í–‰ì‚¬ ì¢…ë£Œ í›„ 30ì¼ ë‚´ íŒŒê¸°í•œë‹¤.</div>
          <button class="btn submit" id="submitBtn" type="submit">ë³´ë‚´ê¸°</button>
        </div>

        <p id="message" class="notice" role="status" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite"></div>

  <script>
    /* 0) ì„¤ì • */
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyLqPcobeZs4B208tJhQ0JSIQilnXGQ4o7bwMu8Vd2QmF7-7Zk9eb0fA3DNcb5M-raf/exec";
    const MAX_SIZE = 10 * 1024 * 1024; // 10MB (Apps Script + ì´ë©”ì¼ ì²¨ë¶€ í•œë„ ê³ ë ¤)

    /* ìœ í‹¸ */
    const $ = (s,el=document)=>el.querySelector(s);
    function toast(msg, ms=2200){ const t=$("#toast"); t.textContent=msg; t.style.opacity=1; t.style.transform="translateY(0)"; clearTimeout(window.__toastTimer); window.__toastTimer=setTimeout(()=>{t.style.opacity=0; t.style.transform="translateY(8px)"}, ms); }
    function isEmail(s){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s); }
    function isPhone(s){ return /[0-9]{7,}/.test(String(s).replace(/\D/g,'')); }

    /* íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° */
    const fileInput = $("#artFile");
    fileInput.addEventListener("change", ()=>{
      const f = fileInput.files && fileInput.files[0];
      if (!f){ $("#filePreview").hidden = true; return; }
      if (f.size > MAX_SIZE){ fileInput.value=""; $("#filePreview").hidden=true; toast("íŒŒì¼ í¬ê¸°ëŠ” ìµœëŒ€ 10MBì´ë‹¤."); return; }
      $("#fileName").textContent = f.name;
      $("#fileMeta").textContent = `(${f.type || "image/*"}, ${(f.size/1024/1024).toFixed(2)}MB)`;
      const img = $("#fileImg");
      img.src = URL.createObjectURL(f);
      img.onload = ()=> URL.revokeObjectURL(img.src);
      $("#filePreview").hidden = false;
    });

    /* íŒŒì¼ â†’ base64 JSONìš© */
    function fileToBase64(file){
      return new Promise((resolve,reject)=>{
        const reader = new FileReader();
        reader.onload = ()=> {
          const dataUrl = reader.result; // data:*/*;base64,AAAA
          const base64 = String(dataUrl).split(",")[1] || "";
          resolve({ name:file.name, mimeType:file.type || "application/octet-stream", size:file.size, data:base64 });
        };
        reader.onerror = ()=> reject(new Error("íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ë‹¤."));
        reader.readAsDataURL(file);
      });
    }

    /* ì œì¶œ */
    $("#submitForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const name = $("#artistName").value.trim();
      const contact = $("#artistContact").value.trim();
      const title = $("#artTitle").value.trim();
      const desc  = $("#artDesc").value.trim();
      const f = fileInput.files && fileInput.files[0];

      if (!name){ toast("ì´ë¦„/ë‹‰ë„¤ì„ì„ ì…ë ¥í•œë‹¤."); return; }
      if (!contact || !(isEmail(contact) || isPhone(contact))){ toast("ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•œë‹¤."); return; }
      if (!title){ toast("ì‘í’ˆ ì œëª©ì„ ì…ë ¥í•œë‹¤."); return; }
      if (!f){ toast("ì‘í’ˆ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•œë‹¤."); return; }
      if (f.size > MAX_SIZE){ toast("íŒŒì¼ í¬ê¸°ëŠ” ìµœëŒ€ 10MBì´ë‹¤."); return; }

      $("#submitBtn").disabled = true;
      $("#message").textContent = "ì „ì†¡ì„ ì²˜ë¦¬í•œë‹¤â€¦";

      try{
        const fileObj = await fileToBase64(f);
        const payload = { name, contact, title, desc, files:[fileObj], ua:navigator.userAgent, ref:document.referrer||"" };

        // CORS ì œì•½ íšŒí”¼: ì‘ë‹µì„ ì½ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ x-www-form-urlencoded + no-cors
        const body = new URLSearchParams({ payload: JSON.stringify(payload) });

        await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body
        });

        $("#message").innerHTML = '<span class="success">ì œì¶œì´ ì ‘ìˆ˜ë˜ì—ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.</span>';
        toast("ì ‘ìˆ˜ ì™„ë£Œ");
        $("#submitForm").reset();
        $("#filePreview").hidden = true;
      } catch(err){
        console.error(err);
        $("#message").innerHTML = '<span class="error">ì „ì†¡ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•œë‹¤.</span>';
        toast("ì „ì†¡ ì‹¤íŒ¨");
      } finally{
        $("#submitBtn").disabled = false;
      }
    });
  </script>
</body>
</html>
