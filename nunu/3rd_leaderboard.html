<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì œ 3íšŒ ë¦¬ë”ë³´ë“œ â€“ ëˆ„ì— ê³ ì¹˜ ì„±ë³„ ë§ì¶”ê¸° ëŒ€íšŒ</title>
  <style>
    :root{
      --bg:#ffffff; --paper:#ffffff; --ink:#111827; --sub:#6b7280; --muted:#e5e7eb;
      --radius:14px; --shadow:0 10px 30px rgba(17,24,39,.08);
      --box-w:980px;

      /* category colors */
      --gold:#f59e0b;     /* í™©ê¸ˆ */
      --mimic:#8b5cf6;    /* ë¯¸ë¯¹ */
      --bomb:#b91c1c;     /* í•¨ì •(=í­íƒ„) */
      --normal:#9ca3af;   /* ì¼ë°˜ */

      /* neutral chip (ë¹„ê³µê°œ ìƒíƒœ) */
      --chip-bg:#f3f4f6;  --chip-bd:#e5e7eb; --chip-tx:#374151;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif}
    .wrap{max-width:1120px;margin:0 auto;padding:20px 24px}

    /* NAV */
    header.nav{position:sticky;top:0;backdrop-filter:saturate(180%) blur(8px);
      background:rgba(247,246,243,.75);border-bottom:1px solid var(--muted);z-index:50}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:10px 18px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    .brand strong{font-weight:800;letter-spacing:.2px}
    .nav-actions{display:flex;gap:8px;align-items:center;justify-content:center}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:9px 12px;border-radius:999px;border:1px solid var(--muted);
      background:var(--paper);color:var(--ink);text-decoration:none;font-weight:600}
    .btn.primary{background:#4b5563;color:#ffffff;border:0}
    .btn:hover{box-shadow:0 6px 18px rgba(15,23,42,.08)}

    /* HERO */
    .hero{margin:14px auto 10px;border:1px solid var(--muted);border-radius:var(--radius);
      background:var(--paper);box-shadow:var(--shadow);max-width:var(--box-w)}
    .hero-inner{padding:16px 18px}
    .hero h1{margin:0;font-size:clamp(20px,3vw,28px);letter-spacing:-.2px;line-height:1.18}
    .lead{color:var(--sub);margin:8px 0 6px}
    .guides{color:#4b5563;margin:6px 0 0;padding-left:18px;list-style:disc}
    .guides li{margin:4px 0}

    /* ì¹´ë“œ */
    .card{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);
      box-shadow:var(--shadow);overflow:hidden;max-width:var(--box-w);margin-left:auto;margin-right:auto}
    .card .inner{padding:16px 18px}
    h2{margin:0 0 10px;font-size:20px}

    /* ë²”ë¡€ */
    .legend{display:flex;flex-wrap:wrap;gap:10px 16px;align-items:center;margin:8px 0 10px;color:#374151}
    .legend .item{display:inline-flex;align-items:center;gap:8px}
    .legend .label{
      font-size:14px; writing-mode:horizontal-tb; text-orientation:mixed; white-space:nowrap;
    }
    .legend .label[data-type="bomb"]{color:var(--bomb);font-weight:700}
    .legend-note{font-size:13px;color:#6b7280;margin-top:4px}

    /* í‘œ */
    .table-wrap{border:1px solid var(--muted);border-radius:12px;background:#fff}
    table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
    thead th{position:sticky;top:0;background:#f8fafc;border-bottom:1px solid var(--muted);
      text-align:left;padding:10px 12px;font-size:14px;color:#334155;white-space:nowrap}
    tbody td{padding:9px 12px;border-bottom:1px solid #f1f5f9;vertical-align:middle;overflow:hidden}
    tbody tr:hover{background:#fafafa}
    .rowno-col{width:46px;color:#64748b}
    .rank-col{width:120px}
    .nick-col{width:190px}
    .score-col{width:70px}
    .rowno{font-weight:700;opacity:.8}
    .rank{font-weight:800;white-space:nowrap}
    .nick{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .score{font-weight:800;white-space:nowrap}

    /* 20ì¹¸ ê·¸ë¦¬ë“œ */
    .answers{display:grid;grid-template-columns:repeat(20, minmax(18px,1fr));gap:3px;align-items:center;width:100%}

    /* ì¹© ('?' ê¸°ë³¸) */
    .chip{
      position:relative;display:inline-flex;align-items:center;justify-content:center;
      height:18px;border-radius:5px;border:1px solid var(--chip-bd);background:var(--chip-bg);
      color:var(--chip-tx);font-weight:800;letter-spacing:.2px;padding:0;width:100%;
    }
    .chip .t{font-size:11.5px;line-height:1}

    /* ì¹© ëª¨ì„œë¦¬ ìƒ‰ */
    .chip::after{
      content:"";position:absolute;top:-2px;left:-2px;width:0;height:0;
      border-bottom:10px solid transparent;border-left:10px solid var(--normal);
    }
    .chip[data-cat="gold"]::after{  border-left-color:var(--gold)}
    .chip[data-cat="mimic"]::after{ border-left-color:var(--mimic)}
    .chip[data-cat="bomb"]::after{  border-left-color:var(--bomb)}
    .chip[data-cat="normal"]::after{border-left-color:var(--normal)}

    /* ë²”ë¡€ ì¹© í¬ê²Œ */
    .legend .chip{height:28px;min-width:28px;width:auto;padding:0 10px;border-radius:8px}
    .legend .chip .t{font-size:14px;line-height:1}
    .legend .chip::after{top:-3px;left:-3px;border-bottom:12px solid transparent;border-left:12px solid var(--normal)}
    .legend .chip[data-cat="gold"]::after{  border-left-color:var(--gold)}
    .legend .chip[data-cat="mimic"]::after{ border-left-color:var(--mimic)}
    .legend .chip[data-cat="bomb"]::after{  border-left-color:var(--bomb)}
    .legend .chip[data-cat="normal"]::after{border-left-color:var(--normal)}

    /* ì»¤ìŠ¤í…€ í˜¸ë²„ ì¹´ë“œ */
    .hovercard{
      position:fixed; z-index:1000; pointer-events:none; opacity:0; transform:translateY(6px);
      transition:opacity .12s ease, transform .12s ease;
      background:#fff; border:1px solid #e5e7eb; border-radius:10px; box-shadow:0 12px 28px rgba(2,6,23,.18);
      overflow:hidden; min-width:220px; max-width:280px;
    }
    .hovercard.show{opacity:1; transform:translateY(0)}
    .hovercard .meta{padding:10px 12px; font-size:13px; color:#334155; display:flex; align-items:center; gap:8px}
    .hovercard .pill{
      display:inline-flex; align-items:center; padding:2px 8px; border-radius:999px; font-weight:700; font-size:12px; color:#fff
    }
    .pill.gold{background:var(--gold)} .pill.mimic{background:var(--mimic)}
    .pill.bomb{background:var(--bomb)} .pill.normal{background:var(--normal)}

    .hovercard .imgwrap{
      display:flex; justify-content:center; align-items:center;
      width:100%; background:#f3f4f6; border-top:1px solid #e5e7eb; padding:8px 0;
    }
    .hovercard .imgwrap img{
      display:block; width:25%; height:auto; object-fit:contain;
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="nav-inner wrap">
      <a class="brand" href="#" aria-label="ëˆ„ì— ëŒ€íšŒ í™ˆ"><strong>ğŸ›ëˆ„ì— ê³ ì¹˜ ì„±ë³„ ë§ì¶”ê¸° ëŒ€íšŒ</strong></a>
      <nav class="nav-actions">
        <a class="btn" href="https://www.hanri.net/nunu/index.html">HOME</a>
        <a class="btn primary" href="https://www.hanri.net/nunu/3rd_submit.html">ì œ 3íšŒ ì°¸ì—¬í•˜ê¸°</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <main class="wrap">
    <div class="hero">
      <div class="hero-inner">
        <h1>ğŸ›ì œ 3íšŒ ë¦¬ë”ë³´ë“œ</h1>
        <ul class="guides">
          <li>ì§€ê¸ˆì€ ë¹„ê³µê°œ ëª¨ë“œë¼ ì œì¶œëœ ë¬¸í•­ì€ ì „ë¶€ <b>?</b> í•œ ê¸€ìë¡œë§Œ í‘œì‹œê°€ ë©ë‹ˆë‹¤.</li>
          <li>ì¼ë°˜ê³ ì¹˜ê°€ ìš°í™”ë˜ëŠ” ìˆœê°„ ì°¸ì—¬ë¥¼ ë§ˆë¬´ë¦¬í•˜ê³  ëª¨ë“  ì œì¶œì§€ê°€ ì˜¤í”ˆë©ë‹ˆë‹¤.</li>
          <li>ì œì¶œì§€ì—ëŠ” <b>ì•”/ìˆ˜</b>ë¡œ í‘œê¸°ê°€ ë˜ë©°,  <b style="color:#1e3a8a">íŒŒë‘(ì •ë‹µ)</b> Â· <b style="color:#b91c1c">ë¹¨ê°•(ì˜¤ë‹µ)</b>ìœ¼ë¡œ êµ¬ë¶„í•©ë‹ˆë‹¤.</li>
          <li>ì œì¶œì§€ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ëˆ„ì—ì˜ ì´ë¦„ê³¼ ëˆ„ì— ë‚˜ë°©ì‚¬ì§„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          <li>1Â·2Â·3ìœ„ë§Œ ğŸ¥‡/ğŸ¥ˆ/ğŸ¥‰ ì´ëª¨ì§€, ê·¸ ì™¸ëŠ” në“± ìœ¼ë¡œ í‘œì‹œ ë©ë‹ˆë‹¤.</li>
          <li>ë™ì ìëŠ” ë™ì¼ ìˆœìœ„ì´ë©°, ë‹¤ìŒ ìˆœìœ„ëŠ” ì—°ì†ìœ¼ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤</li>
        </ul>
      </div>
    </div>
  </main>

  <div class="wrap">
    <section class="card">
      <div class="inner">
        <h2>ë¦¬ë”ë³´ë“œ</h2>

        <!-- ì¹´í…Œê³ ë¦¬ ë²”ë¡€ -->
        <div class="legend" aria-label="ì¹´í…Œê³ ë¦¬ ë²”ë¡€">
          <span class="item"><span class="chip" data-cat="gold"><span class="t">?</span></span><span class="label">í™©ê¸ˆê³ ì¹˜</span></span>
          <span class="item"><span class="chip" data-cat="mimic"><span class="t">?</span></span><span class="label">ë¯¸ë¯¹ê³ ì¹˜</span></span>
          <span class="item"><span class="chip" data-cat="bomb"><span class="t">?</span></span><span class="label" data-type="bomb">í•¨ì •ê³ ì¹˜</span></span>
          <span class="item"><span class="chip" data-cat="normal"><span class="t">?</span></span><span class="label">ì¼ë°˜ê³ ì¹˜</span></span>
        </div>
        <div class="legend-note">â€» CAT_MAPì„ ë³€ê²½í•˜ì—¬ ë¬¸ì œë³„ ì¹´í…Œê³ ë¦¬ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆì–´ìš”.</div>

        <div class="table-wrap" id="tableWrap"><div style="padding:14px;color:var(--sub)">ë°ì´í„° ë¡œë”© ì¤‘â€¦</div></div>
      </div>
    </section>
  </div>

  <!-- ì»¤ìŠ¤í…€ í˜¸ë²„ ì¹´ë“œ -->
  <div id="hovercard" class="hovercard" role="dialog" aria-hidden="true">
    <div class="meta"><span class="pill">â€”</span><span class="text">â€”</span></div>
    <div class="imgwrap"><img alt=""></div>
  </div>

  <script>
    /* ========================
       0) ì„¤ì •: ì •ë‹µí‚¤ & ì¹´í…Œê³ ë¦¬ & ê¸°ë³¸ ì´ë¯¸ì§€ / ê³µê°œ ê·œì¹™
    ======================== */

    // ì±„ì í‚¤(20ì¹¸). ì¼ë°˜ ê³ ì¹˜ ìë¦¬ì—ë§Œ F/Mì„ ë„£ìœ¼ë©´ ë¨(ë§ìœ¼ë©´ +1). íŠ¹ìˆ˜ ê³ ì¹˜ ì¹¸ì€ ì–´ë–¤ ë¬¸ìê°€ ì™€ë„ ë¬´ì‹œ.
    const ANSWER_KEY_FM = "";

    // (ë¯¸ê³µê°œ ë©”ëª¨) ìš”ì²­ì‚¬í•­: 5, 20ë²ˆì€ íŠ¹ìˆ˜ê³ ì¹˜ì´ë©° Fë¡œ ê¸°ë¡ë§Œ(í‘œì‹œ/ì±„ì ì—” ë¯¸ì‚¬ìš©)
    const HIDDEN_ANSWER_MEMO = { 5:'F', 20:'F' };

    // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
    const CAT_MAP = {
      3:'ë¯¸ë¯¹', 10:'ë¯¸ë¯¹', 13:'ë¯¸ë¯¹',
      5:'í™©ê¸ˆ', 17:'í™©ê¸ˆ',
      8:'í•¨ì •', 20:'í•¨ì •'
      // ë‚˜ë¨¸ì§€ëŠ” 'ì¼ë°˜'
    };

    // ê¸°ë³¸ ì´ë¯¸ì§€
    const DEFAULT_IMAGE_URL = "https://e7.pngegg.com/pngimages/699/153/png-clipart-emoji-thought-blushing-emoji-face-smiley.png";

    // ğŸ”’ ì§€ê¸ˆì€ ì œì¶œì§€ ì „ë¶€ ? ë¡œ ê³ ì •
    const REVEAL = {
      normals: false,  // ì¼ë°˜ë„ ìˆ¨ê¹€
      specials: false, // íŠ¹ìˆ˜ë„ ìˆ¨ê¹€
      whitelist: []
    };
    const SPECIAL_REVEAL_AT = null; // ì˜ˆ: '2025-12-01T09:00:00+09:00'

    /* ===== ìœ í‹¸ ===== */
    const normCat = (cat) => {
      if (cat==='í­íƒ„' || cat==='í•¨ì •') return 'í•¨ì •';
      if (cat==='ê³¨ë“œ') return 'í™©ê¸ˆ';
      if (cat==='ìœ„ì¥') return 'ë¯¸ë¯¹';
      return (cat==='í™©ê¸ˆ'||cat==='ë¯¸ë¯¹'||cat==='ì¼ë°˜'||cat==='í•¨ì •') ? cat : 'ì¼ë°˜';
    };
    const catToData = (cat) => {
      const c = normCat(cat);
      return c==='í™©ê¸ˆ' ? 'gold' : c==='ë¯¸ë¯¹' ? 'mimic' : c==='í•¨ì •' ? 'bomb' : 'normal';
    };
    const isSpecial = (cat) => ['í™©ê¸ˆ','ë¯¸ë¯¹','í•¨ì •'].includes(normCat(cat));
    const specialsOpenNow = () => {
      if (REVEAL.specials) return true;
      if (!SPECIAL_REVEAL_AT) return false;
      const t = Date.parse(SPECIAL_REVEAL_AT);
      return Number.isFinite(t) && Date.now() >= t;
    };

    function medalRank(n){ if(n===1) return 'ğŸ¥‡ 1ë“±'; if(n===2) return 'ğŸ¥ˆ 2ë“±'; if(n===3) return 'ğŸ¥‰ 3ë“±'; return n+'ë“±'; }
    function denseRankAndSort(rows){
      const arr = rows.slice().sort((a,b)=> (b.score??-Infinity) - (a.score??-Infinity));
      const uniq=[]; arr.forEach(r=>{ if(typeof r.score==='number' && !uniq.includes(r.score)) uniq.push(r.score); });
      const m = new Map(uniq.map((sc,i)=>[sc,i+1]));
      arr.forEach(r=> r._rank = typeof r.score==='number' ? m.get(r.score) : null);
      return arr;
    }

    // TSV â†’ 'F' | 'M' | '?'
    const toFM = (ch) => {
      const v = String(ch || '').trim().toUpperCase();
      if (['A','F','ì—¬','FEMALE'].includes(v)) return 'F';
      if (['S','M','ë‚¨','MALE'].includes(v))   return 'M';
      return '?'; // D, ?, ë¹ˆê°’ í¬í•¨
    };

    // ë¬¸ì œëª…ì´ ì´ë¯¸ "08. ..."ì²˜ëŸ¼ ë²ˆí˜¸ë¥¼ í¬í•¨í•˜ë©´ ì¤‘ë³µ ë°©ì§€
    function formatDisplayName(qno, rawName){
      const name = String(rawName || '').trim();
      return (/^\d{1,2}\.\s*/.test(name)) ? name : `${qno}. ${name}`;
    }

    // ì±„ì í‚¤ íŒŒì‹±(ê¸¸ì´ 20, ê° ì¹¸ 'F'/'M'ì´ë©´ ìœ íš¨, ì•„ë‹ˆë©´ null)
    function parseKey(str){
      const arr = Array.from({length:20}, (_,i)=>{
        const c = (str && str[i]) ? str[i].toUpperCase() : '';
        return (c==='F' || c==='M') ? c : null;
      });
      return arr;
    }

    /* ===== TSV íŒŒì„œ & ì ìˆ˜ ===== */
    function parseTSV(tsv){
      const lines = tsv.split(/\r?\n/).filter(Boolean);
      if(lines.length<2) return {headers:[], images:[], rows:[], hasAnyScore:false};

      const header = lines[0].split('\t');
      const idx = Object.fromEntries(header.map((k,i)=>[k,i]));

      // ë¬¸ì œ ì´ë¦„ â€” ì²« ë°ì´í„°í–‰ì—ì„œ ì·¨ë“(ëª¨ë“  í–‰ ê³µí†µ ê°€ì •)
      const first = lines[1].split('\t');
      const qNames = [];
      for(let i=1;i<=20;i++){
        qNames.push((first[idx[`q${i}name`]]||'').trim() || `Q${i}`);
      }
      // ì´ë¯¸ì§€: ìš”ì²­ëŒ€ë¡œ ì „ë¶€ ë™ì¼ ê¸°ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©
      const qImgs = Array.from({length:20}, ()=> DEFAULT_IMAGE_URL);

      // ì¹´í…Œê³ ë¦¬ ë°°ì—´
      const CATEGORY = Array.from({length:20}, (_,i)=> normCat(CAT_MAP[i+1] || 'ì¼ë°˜'));

      // ì±„ì í‚¤(ì¼ë°˜ë§Œ ì‚¬ìš©)
      const keyArr = parseKey(ANSWER_KEY_FM);
      const hasAnyNormalKey = keyArr.some((k, i)=> k && CATEGORY[i]==='ì¼ë°˜');

      const rows = lines.slice(1).map((line, lineNo)=>{
        const c = line.split('\t');
        const nickname = (c[idx['nickname']]||'').trim() || (c[idx['name']]||'').trim() || `ì°¸ê°€ì${lineNo+1}`;
        const timestamp = (c[idx['timestamp']]||'').trim();

        const ansArr = Array.from({length:20}, (_,i)=>{
          const gk = `q${i+1}gender`;
          const v = (c[idx[gk]]||'').trim();
          return toFM(v||'?');
        });

        let score = null;
        if(hasAnyNormalKey){
          let s = 0;
          for(let i=0;i<20;i++){
            const cat = CATEGORY[i];
            const k = keyArr[i];              // 'F'|'M'|null
            if (cat !== 'ì¼ë°˜') continue;      // íŠ¹ìˆ˜ê³ ì¹˜ëŠ” ì ìˆ˜ ë¯¸ë°˜ì˜
            if (!k) continue;                  // í‚¤ ì—†ëŠ” ì¹¸ì€ ìŠ¤í‚µ
            const a = ansArr[i];               // 'F'|'M'|'?'
            if (a === k) s += 1;               // ì¼ë°˜: ë§ìœ¼ë©´ +1, ê·¸ ì™¸ 0
          }
          score = s;
        }
        return { nickname, timestamp, ans: ansArr.join(''), score };
      });

      return { headers:qNames, images:qImgs, rows, hasAnyScore:hasAnyNormalKey };
    }

    /* ===== ë Œë” ===== */
    function renderFromTSV(tsv){
      const parsed = parseTSV(tsv);

      // ì¹´í…Œê³ ë¦¬ ë°°ì—´
      const CATEGORY = Array.from({length:20}, (_,i)=> normCat(CAT_MAP[i+1] || 'ì¼ë°˜'));

      // ì •ë ¬/ë­í¬
      const data = parsed.hasAnyScore ? denseRankAndSort(parsed.rows) : parsed.rows;

      const tbl = document.createElement('table');

      // THEAD
      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr>
          <th class="rowno-col">#</th>
          <th class="rank-col">ìˆœìœ„</th>
          <th class="nick-col">ë‹‰ë„¤ì„</th>
          <th class="score-col">ì ìˆ˜</th>
          <th>ì œì¶œì§€</th>
        </tr>`;
      tbl.appendChild(thead);

      // TBODY
      const tbody = document.createElement('tbody');

      data.forEach((row, rowIndex)=>{
        const tr = document.createElement('tr');

        // ë²ˆí˜¸(ì •ë ¬ ê²°ê³¼ ê¸°ì¤€)
        const tdNo = document.createElement('td');
        tdNo.className = 'rowno';
        tdNo.textContent = (rowIndex+1)+'.';

        // ìˆœìœ„
        const tdRank = document.createElement('td');
        tdRank.className='rank';
        tdRank.textContent = (typeof row._rank==='number') ? medalRank(row._rank) : 'â€”';

        // ë‹‰ë„¤ì„
        const tdNick = document.createElement('td');
        tdNick.className='nick';
        tdNick.textContent = row.nickname || '-';

        // ì ìˆ˜
        const tdScore= document.createElement('td');
        tdScore.className='score';
        tdScore.textContent = (typeof row.score==='number') ? `${row.score}ì ` : 'â€”';

        // ì œì¶œì§€ (ì¹© 20ê°œ)
        const tdAns = document.createElement('td');
        const wrap = document.createElement('div');
        wrap.className='answers';

        for (let i=0;i<20;i++){
          const chip = document.createElement('span');
          chip.className='chip';

          const catStr = CATEGORY[i];             // 'ì¼ë°˜' | 'í™©ê¸ˆ' | 'ë¯¸ë¯¹' | 'í•¨ì •'
          const special = isSpecial(catStr);
          const userCh  = (row.ans[i] || '?');    // 'F' | 'M' | '?'

          // ê³µê°œ ê·œì¹™: ì§€ê¸ˆì€ ë¬´ì¡°ê±´ '?' (normals=false, specials=false)
          let visibleCh = '?';
          if (REVEAL.whitelist?.includes(i+1)) {
            visibleCh = userCh; // í•„ìš” ì‹œ íŠ¹ì • ë¬¸í•­ë§Œ ê³µê°œ
          } else if (special) {
            visibleCh = specialsOpenNow() ? userCh : '?';
          } else {
            visibleCh = REVEAL.normals ? userCh : '?';
          }

          chip.dataset.cat   = catToData(catStr); // gold/mimic/bomb/normal
          chip.dataset.qindex= i;                 // 0~19
          chip.dataset.qname = parsed.headers[i];
          chip.dataset.qcat  = catStr;
          chip.dataset.qimg  = parsed.images[i] || '';

          const t = document.createElement('span');
          t.className='t';
          t.textContent = (visibleCh==='F' || visibleCh==='M') ? visibleCh : '?';
          chip.appendChild(t);
          wrap.appendChild(chip);
        }

        tdAns.appendChild(wrap);
        tr.appendChild(tdNo);
        tr.appendChild(tdRank);
        tr.appendChild(tdNick);
        tr.appendChild(tdScore);
        tr.appendChild(tdAns);
        tbody.appendChild(tr);
      });

      tbl.appendChild(tbody);

      const host = document.getElementById('tableWrap');
      host.innerHTML='';
      host.appendChild(tbl);

      // í˜¸ë²„ ì¹´ë“œ ì´ë²¤íŠ¸(ìœ„ì„)
      attachHovercard();
    }

    /* ===== ì»¤ìŠ¤í…€ í˜¸ë²„ ì¹´ë“œ ===== */
    function attachHovercard(){
      const card = document.getElementById('hovercard');
      const img = card.querySelector('img');
      const pill = card.querySelector('.pill');
      const text = card.querySelector('.text');
      const imgwrap = card.querySelector('.imgwrap');

      function showCard(x, y, chip){
        const qno = String(Number(chip.dataset.qindex)+1).padStart(2,'0');
        const rawName = chip.dataset.qname || '';
        const dispName = formatDisplayName(qno, rawName); // ë²ˆí˜¸ ì¤‘ë³µ ë°©ì§€
        const catStr = chip.dataset.qcat;                 // ì¼ë°˜/í™©ê¸ˆ/ë¯¸ë¯¹/í•¨ì •
        const catKey = chip.dataset.cat;                  // normal/gold/mimic/bomb
        const url = chip.dataset.qimg;

        // ë‚´ìš© ê°±ì‹ 
        const catTitle = (catStr==='í™©ê¸ˆ'?'í™©ê¸ˆê³ ì¹˜':catStr==='ë¯¸ë¯¹'?'ë¯¸ë¯¹ê³ ì¹˜':catStr==='í•¨ì •'?'í•¨ì •ê³ ì¹˜':'ì¼ë°˜ê³ ì¹˜');
        pill.textContent = catTitle;
        pill.className = `pill ${catKey}`;
        text.textContent = dispName;

        if(url){
          img.src = url;
          img.alt = dispName;
          imgwrap.style.display = 'flex';
        }else{
          img.removeAttribute('src');
          img.alt = '';
          imgwrap.style.display = 'none';
        }

        // ìœ„ì¹˜ ê³„ì‚°
        const pad = 14;
        const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

        card.style.left = (x + pad) + 'px';
        card.style.top  = (y + pad) + 'px';
        card.classList.add('show');
        card.setAttribute('aria-hidden','false');

        requestAnimationFrame(()=>{
          const rect = card.getBoundingClientRect();
          let left = rect.left, top = rect.top;
          if(rect.right > vw - 8) left = x - rect.width - pad;
          if(rect.bottom > vh - 8) top = y - rect.height - pad;
          card.style.left = Math.max(8, left) + 'px';
          card.style.top  = Math.max(8, top)  + 'px';
        });
      }

      function hideCard(){
        card.classList.remove('show');
        card.setAttribute('aria-hidden','true');
      }

      const tableWrap = document.getElementById('tableWrap');
      tableWrap.addEventListener('mousemove', (e)=>{
        const target = e.target.closest('.chip');
        if(target){ showCard(e.clientX, e.clientY, target); }
        else{ hideCard(); }
      });
      tableWrap.addEventListener('mouseleave', hideCard);
    }

    /* ========================
       TSV ë¡œë“œ (ê°™ì€ í´ë”ì˜ íŒŒì¼)
       - nunu3_responses.tsv ë¥¼ ê°™ì€ í´ë”ì— ë‘ì„¸ìš”.
    ======================== */
    fetch('nunu3_responses.tsv', {cache:'no-store'})
      .then(r => { if(!r.ok) throw new Error('TSV ë¡œë“œ ì‹¤íŒ¨'); return r.text(); })
      .then(text => renderFromTSV(text))
      .catch(err => {
        console.error(err);
        const host = document.getElementById('tableWrap');
        host.innerHTML =
          '<div style="padding:14px;color:#b91c1c">TSVë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. '+
          'ì´ HTMLê³¼ ê°™ì€ í´ë”ì— <b>nunu3_responses.tsv</b>ë¥¼ ë„£ì–´ì£¼ì„¸ìš”.</div>';
      });

    /* ========================
       ê¸°ë³¸ ë³´ì•ˆ(ìš°í´ë¦­/ë‹¨ì¶•í‚¤ ì°¨ë‹¨) â€” ì™„ì „ ì°¨ë‹¨ì€ ë¶ˆê°€, ì–µì œìš©
    ======================== */
    document.addEventListener('contextmenu', (e)=> e.preventDefault());
    document.addEventListener('dragstart', (e)=> e.preventDefault());
    document.addEventListener('keydown', (e)=>{
      const k = e.key.toUpperCase();
      if (
        e.keyCode===123 || // F12
        (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(k)) || // DevTools
        (e.ctrlKey && ['U','S','P'].includes(k)) // ì†ŒìŠ¤ë³´ê¸°/ì €ì¥/ì¸ì‡„
      ){
        e.preventDefault();
        e.stopPropagation();
      }
    }, true);
  </script>
</body>
</html>
