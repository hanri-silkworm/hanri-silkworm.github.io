<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ëˆ„ì— ê·¸ë¦¼ ëŒ€íšŒ â€” ì˜¨ë¼ì¸ íˆ¬í‘œ</title>
  <meta name="description" content="ëˆ„ì— ê·¸ë¦¼ ê·¸ë¦¬ê¸° ëŒ€íšŒ ì˜¨ë¼ì¸ íˆ¬í‘œ í˜ì´ì§€" />
  <style>
    :root{
      --bg:#ffffff; --paper:#ffffff; --ink:#111827; --sub:#6b7280;
      --pri:#4b5563; --pri-2:#374151; --muted:#e5e7eb; --ring:rgba(107,114,128,.25);
      --radius:16px; --shadow:0 10px 30px rgba(17,24,39,.08);
      --wrap:1100px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,Arial,sans-serif}
    img{max-width:100%;display:block}
    .wrap{max-width:var(--wrap);margin:0 auto;padding:24px}

    /* NAV */
    header.nav{position:sticky;top:0;backdrop-filter:saturate(180%) blur(8px);background:rgba(247,246,243,.8);border-bottom:1px solid var(--muted);z-index:50}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 18px}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--ink)}
    .brand strong{font-weight:800;letter-spacing:.2px}

    /* CARD */
    main .card{background:var(--paper);border:1px solid var(--muted);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .section-title{margin:0 0 10px;font-size:18px}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:700px){.row{grid-template-columns:1fr 1fr}}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:14px;font-weight:800}
    .field input{border:1px solid #d1d5db;border-radius:12px;padding:12px;font-size:15px}
    .hint{color:var(--sub);font-size:13px;margin:6px 0 0}
    .toolbar{margin-top:14px;display:flex;justify-content:space-between;align-items:center;gap:8px}
    .count{font-weight:800;font-size:14px;color:var(--pri-2)}
    .btn.submit{border:0;border-radius:12px;font-weight:800;padding:12px 16px;cursor:pointer;background:#111827;color:#fff;font-size:15px}
    .btn.submit[disabled]{opacity:.5;cursor:not-allowed}

    /* GALLERY */
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px}
    @media (min-width:560px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (min-width:980px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .art{border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;background:#fff;display:flex;flex-direction:column;transition:transform .12s ease, box-shadow .12s ease}
    .art:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(17,24,39,.08)}
    .thumb{position:relative;aspect-ratio:4/3;width:100%;background:#f6f6f6;overflow:hidden;cursor:pointer}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .zoom-hint{position:absolute;inset:auto 8px 8px auto;background:rgba(17,24,39,.6);color:#fff;border-radius:999px;padding:6px 9px;font-size:12px}
    .info{padding:10px 12px;display:flex;align-items:flex-start;gap:10px}
    .badge{font-size:12px;background:#111827;color:#fff;padding:4px 8px;border-radius:999px}
    .title{font-weight:800;font-size:15px;margin:0}
    .muted{color:#6b7280;font-size:12px;margin:4px 0 0}
    .desc{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

    /* LIGHTBOX */
    .lightbox{position:fixed;inset:0;background:rgba(17,24,39,.85);display:none;align-items:center;justify-content:center;padding:24px;z-index:100}
    .lightbox.open{display:flex}
    .lb-figure{position:relative;margin:0;max-width:min(96vw,1200px);max-height:90vh;border-radius:14px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.35);background:#000;display:flex;flex-direction:column}
    .lb-figure img{display:block;max-width:100%;max-height:72vh;margin:0 auto}
    .lb-cap{position:static;background:#fff;color:#111827;padding:14px 16px;font-size:14px;line-height:1.5;border-top:1px solid #e5e7eb}
    .lb-title{font-weight:800;font-size:16px}
    .lb-desc{color:#6b7280;font-size:14px;margin-top:4px}
    .lb-btn{position:absolute;top:50%;transform:translateY(-50%);border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.08);backdrop-filter:blur(6px);color:#fff;padding:10px 12px;border-radius:12px;cursor:pointer}
    .lb-prev{left:10px}
    .lb-next{right:10px}
    .lb-close{top:10px;right:10px;transform:none;border:1px solid rgba(255,255,255,.35);background:rgba(0,0,0,.4);padding:10px 12px;border-radius:12px}
    @media (max-width:720px){ .wrap{padding:18px} .lb-figure img{max-height:64vh} }

    /* Toast */
    #toast{position:fixed;inset:auto 16px 16px auto;background:#111;color:#fff;padding:10px 14px;border-radius:10px;font-size:13px;opacity:0;transform:translateY(8px);transition:all .25s ease}

    /* RULES/AWARDS/PRIZE boxes (spacing â†“) */
    .rules-box, .awards-box, .prize-box{background:#f8fafc;border:1px solid #e5e7eb;border-left:4px solid #cbd5e1;border-radius:14px;box-shadow:var(--shadow);padding:16px 18px;margin-top:6px}
    .rule-list, .award-list, .prize-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}
    .rule-list li, .award-list li, .prize-list li{display:grid;grid-template-columns:22px 1fr;gap:10px;align-items:start}
    .rule-list .ico, .award-list .ico, .prize-list .ico{width:18px;height:18px;line-height:18px;border-radius:50%;background:#6b7280;color:#fff;font-size:12px;display:inline-flex;align-items:center;justify-content:center;margin-top:2px}
    @media (max-width:720px){.rules-box, .awards-box, .prize-box{padding:14px 14px}}
    /* prize icon override (no grey circle, larger emoji) */
    #prize .ico{background:transparent;color:inherit;width:auto;height:auto;line-height:1;font-size:24px;border-radius:0}
    #prize .prize-list li{grid-template-columns:auto 1fr}

    /* PICK BUTTON (left aligned with order number) */
    .pick{margin-top:6px}
    .pick-btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border:1px solid #d1d5db; border-radius:10px;
      background:#fff; font-weight:800; cursor:pointer; text-align:left;
    }
    .pick-btn .pick-order{
      display:none; width:22px; height:22px; border-radius:50%;
      background:#111827; color:#fff; font-size:12px;
      align-items:center; justify-content:center;
    }
    .pick-btn[aria-pressed="true"]{ border-color:#111827; background:rgba(17,24,39,.06) }
    .pick-btn[aria-pressed="true"] .pick-order{ display:inline-flex }
    .pick-btn[disabled]{ opacity:.55; cursor:not-allowed }
  </style>
</head>
<body>
  <!-- NAV -->
  <header class="nav">
    <div class="nav-inner wrap">
      <a class="brand" href="#vote" aria-label="ëˆ„ì— ëŒ€íšŒ í™ˆ"><strong>ğŸ› ëˆ„ì— ê·¸ë¦¼ ëŒ€íšŒ</strong></a>
      <!-- nav-actions ì œê±° -->
    </div>
  </header>

  <!-- RULES -->
  <section id="rules" class="wrap">
    <div class="rules-box" role="region" aria-labelledby="rules-title">
      <h2 id="rules-title" style="margin:0 0 8px;font-size:20px">ê·€ì—¬ìš´ ëˆ„ì— ê·¸ë¦¼ê·¸ë¦¬ê¸° ëŒ€íšŒ</h2>
      <p class="intro" style="margin:6px 0 10px;color:#374151;font-size:14px">ëˆ„ì—ì˜ ë§¤ë ¥ì„ ë‹´ì€ ê·€ì—¬ìš´ ê·¸ë¦¼ì„ í•¨ê»˜ ì¦ê¸°ëŠ” ì‘ì€ ì „ì‹œÂ·íˆ¬í‘œ í–‰ì‚¬ì´ë‹¤. ì‘í’ˆì„ ê°ìƒí•˜ê³  ë§ˆìŒì— ë“œëŠ” ìµœëŒ€ ì„¸ ì‘í’ˆì„ ê³¨ë¼ ì‘ì›í•œë‹¤.</p>
      <ul class="rule-list">
        <li>
          <span class="ico" aria-hidden="true">âœ”</span>
          <div><b>íˆ¬í‘œ</b>: 1ì¸ 1íšŒ, <b>ìµœëŒ€ 3ì‘í’ˆ</b> ì„ íƒ(ë™ì¼ ì‘í’ˆ ì¤‘ë³µ ë¶ˆê°€)</div>
        </li>
      </ul>
    </div>
  </section>

  <!-- AWARDS -->
  <section id="awards" class="wrap">
    <div class="awards-box" role="region" aria-labelledby="awards-title">
      <h2 id="awards-title" style="margin:0 0 8px;font-size:20px">ì‹œìƒ</h2>
      <ul class="award-list">
        <li><span class="ico" aria-hidden="true">1</span><div><b>1ë“±</b>: 1ë“±ìƒ ì´ë¯¸ì§€ ì•„í¬ë¦´ í‚¤ë§ + ì¹˜í‚¨ ì¿ í°</div></li>
        <li><span class="ico" aria-hidden="true">2</span><div><b>2ë“±</b>: ëˆ„ëˆ„ëˆ„ ìŠ¤í‹°ì»¤ + ë°°ë¯¼ ì¿ í°</div></li>
        <li><span class="ico" aria-hidden="true">3</span><div><b>3ë“±</b>: ìŠ¤íƒ€ë²…ìŠ¤ ì¿ í°</div></li>
      </ul>
      <div class="hint" style="margin-top:8px;color:#4b5563;font-size:13px">ë™ì  ì²˜ë¦¬: â‘  ì‹¬ì‚¬ìœ„ì›(3ì¸) í•©ì‚°(ì°½ì˜ì„±Â·ì£¼ì œ ì í•©ì„±Â·ì™„ì„±ë„ ê° 1â€“5ì ) â†’ â‘¡ ì„¤ëª…ë¬¸ í’ˆì§ˆ +1ì (í•„ìš” ì‹œ) â†’ â‘¢ ê³µë™ìˆ˜ìƒ.</div>
    </div>
  </section>

  <!-- PRIZE -->
  <section id="prize" class="wrap">
    <div class="prize-box" role="region" aria-labelledby="prize-title">
      <h2 id="prize-title" style="margin:0 0 8px;font-size:20px">íˆ¬í‘œì ê²½í’ˆ</h2>
      <ul class="prize-list">
        <li>
          <span class="ico" aria-hidden="true">ğŸ</span>
          <div>íˆ¬í‘œì ì¤‘ <b>ì¶”ì²¨ 5ëª…</b>ì„ ì„ ì •í•˜ì—¬ <b>1ë“±ìƒ ì´ë¯¸ì§€ ì•„í¬ë¦´ í‚¤ë§</b>ì„ ë“œë¦°ë‹¤. ì¶”ì²¨ì€ ê²°ê³¼ ë°œí‘œì¼ì— ë¬´ì‘ìœ„ë¡œ ì§„í–‰í•˜ë©°, ë‹¹ì²¨ìì—ê²Œ ê°œë³„ ì—°ë½í•œë‹¤.</div>
        </li>
      </ul>
    </div>
  </section>

  <!-- VOTE -->
  <main class="wrap" id="vote">
    <section class="card" aria-labelledby="form-title">
      <h2 id="form-title" class="section-title">íˆ¬í‘œì ì •ë³´</h2>
      <form id="voteForm" novalidate>
        <div class="row">
          <div class="field">
            <label for="voterName">ì´ë¦„</label>
            <input id="voterName" name="name" type="text" autocomplete="name" required placeholder="í™ê¸¸ë™" />
          </div>
          <div class="field">
            <label for="voterPhone">ì „í™”ë²ˆí˜¸</label>
            <input id="voterPhone" name="phone" type="tel" inputmode="numeric" pattern="[0-9+\-\s]{9,16}" required placeholder="010-1234-5678" />
          </div>
        </div>
        <p class="hint">ì…ë ¥ ì •ë³´ëŠ” ì¤‘ë³µ íˆ¬í‘œ ë°©ì§€ì™€ ê²°ê³¼ ì•ˆë‚´ì—ë§Œ ì‚¬ìš©í•œë‹¤.</p>

        <div style="height:14px"></div>
        <h2 class="section-title" style="margin-top:0">ì‘í’ˆ ì„ íƒ (ìµœëŒ€ 3ê°œ)</h2>
        <div id="gallery" class="grid" aria-live="polite" aria-busy="false"></div>

        <div class="toolbar">
          <div class="count" id="countLabel">0 / 3 ì„ íƒ</div>
          <button class="btn submit" id="submitBtn" type="submit" disabled>íˆ¬í‘œ ì œì¶œ</button>
        </div>

        <p id="message" class="notice" role="status" aria-live="polite"></p>
      </form>
      <footer>ê°œì¸ì •ë³´ ì²˜ë¦¬ ê³ ì§€: ìˆ˜ì§‘ í•­ëª©ì€ ì´ë¦„, ì „í™”ë²ˆí˜¸, ì„ íƒ ì‘í’ˆ ë²ˆí˜¸ì´ë‹¤. ëª©ì ì€ ì¤‘ë³µ íˆ¬í‘œ ë°©ì§€ì™€ ìˆ˜ìƒ ì•ˆë‚´ì´ë‹¤. í–‰ì‚¬ ì¢…ë£Œ í›„ 30ì¼ ë‚´ íŒŒê¸°í•œë‹¤.</footer>
    </section>
  </main>

  <!-- LIGHTBOX -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <button class="lb-close" id="lbClose" aria-label="ë‹«ê¸°">âœ•</button>
    <button class="lb-btn lb-prev" id="lbPrev" aria-label="ì´ì „">â€¹</button>
    <figure class="lb-figure" aria-labelledby="lbCaption">
      <img id="lbImg" alt="ì „ì‹œ ì‘í’ˆ í™•ëŒ€ ë³´ê¸°" />
      <figcaption id="lbCaption" class="lb-cap"></figcaption>
    </figure>
    <button class="lb-btn lb-next" id="lbNext" aria-label="ë‹¤ìŒ">â€º</button>
  </div>

  <!-- Toast -->
  <div id="toast" role="status" aria-live="polite"></div>

  <script>
    /* 0) ì„¤ì • */
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyXushAStBXnqjXmGYmnl2ogr1TkWV7-kGEhoijDLsb6Vm5LSSUjN9eTok3zBq7EqhV8w/exec";
    const MAX_SELECTION = 3;
    const RANDOMIZE_ORDER = false;

    // ì „ì‹œ ì‘í’ˆ ëª©ë¡(ì˜ˆì‹œ)
    const GALLERY = [
      { id: "SM25-001", title: "ì‘í’ˆ ì œëª© 1", desc: "ë´„ ì†Œí’ ê°„ ëˆ„ì—.", image: "images/SM25-001.jpg" },
      { id: "SM25-002", title: "ì‘í’ˆ ì œëª© 2", desc: "ê³ ì¹˜ë¥¼ ì§€í‚¤ëŠ” ì¹œêµ¬.", image: "images/SM25-002.jpg" },
      { id: "SM25-003", title: "ì‘í’ˆ ì œëª© 3", desc: "ë‹¨í’ê³¼ ëˆ„ì—.",   image: "images/SM25-003.jpg" },
      { id: "SM25-004", title: "ì‘í’ˆ ì œëª© 4", desc: "ë¹„ ì˜¤ëŠ” ë‚  ì‚°ì±….", image: "images/SM25-004.jpg" }
    ];

    /* 1) ìœ í‹¸ */
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    function toast(msg, ms=2200){ const t = $("#toast"); t.textContent = msg; t.style.opacity = 1; t.style.transform = "translateY(0)"; clearTimeout(window.__toastTimer); window.__toastTimer = setTimeout(()=>{t.style.opacity=0; t.style.transform="translateY(8px)"}, ms); }
    function normalizePhone(s){ return (s||"").replace(/[^0-9]/g,""); }
    function validPhoneDigits(d){ return d.length >= 9 && d.length <= 16; }
    function phoneKey(d){ return `silkworm_vote_${d}`; }
    function formatKoreanPhone(s){
      const d = String(s||'').replace(/\D/g,'');
      if (d.startsWith('02')){ // ì„œìš¸
        if (d.length <= 2) return d;
        if (d.length <= 5) return d.replace(/(\d{2})(\d{0,3})/, '$1-$2');
        return d.replace(/(\d{2})(\d{3,4})(\d{0,4})/, '$1-$2-$3').replace(/-$/,'');
      } else { // íœ´ëŒ€í°/ê¸°íƒ€
        if (d.length <= 3) return d;
        if (d.length <= 7) return d.replace(/(\d{3})(\d{0,4})/, '$1-$2');
        return d.replace(/(\d{3})(\d{3,4})(\d{0,4})/, '$1-$2-$3').replace(/-$/,'');
      }
    }

    /* 2) ê°¤ëŸ¬ë¦¬ + ì„ íƒ ì œí•œ (ë²„íŠ¼ ë°©ì‹) */
    let currentIndex = -1;
    function renderGallery(){
      const list = RANDOMIZE_ORDER ? shuffle([...GALLERY]) : [...GALLERY];
      const grid = $("#gallery");
      grid.setAttribute('aria-busy','true');
      grid.innerHTML = '';
      list.forEach((art)=>{
        const realIdx = GALLERY.findIndex(a => a.id === art.id);
        const card = document.createElement('article');
        card.className = 'art';
        card.innerHTML = `
          <div class="thumb" data-index="${realIdx}" title="í´ë¦­í•˜ì—¬ í™•ëŒ€">
            <img src="${art.image}" alt="${art.id} ${art.title}" loading="lazy" />
            <span class="zoom-hint">í™•ëŒ€</span>
          </div>
          <div class="info">
            <div class="badge">${art.id}</div>
            <div style="flex:1">
              <p class="title">${art.title}</p>
              <p class="muted desc">${art.desc || ""}</p>
              <div class="pick">
                <button type="button" class="pick-btn" data-id="${art.id}" aria-pressed="false">
                  <span class="pick-order" aria-hidden="true"></span>
                  <span class="pick-text">ì´ ì‘í’ˆ ì„ íƒ</span>
                </button>
              </div>
            </div>
          </div>`;
        grid.appendChild(card);
      });
      grid.setAttribute('aria-busy','false');
      bindChoiceLimit();
      $$(".thumb", grid).forEach(el=>{ el.addEventListener('click', (ev)=>{ ev.stopPropagation(); const idx = Number(el.getAttribute('data-index')) || 0; openLightbox(idx); }); });
    }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

    function bindChoiceLimit(){
      const btns = $$('.pick-btn');
      window.selectedIds = window.selectedIds || [];
      function updateUI(){
        const cnt = selectedIds.length;
        $('#countLabel').textContent = `${cnt} / ${MAX_SELECTION} ì„ íƒ`;
        btns.forEach(btn=>{
          const id = btn.dataset.id;
          const idx = selectedIds.indexOf(id);
          const selected = idx !== -1;
          btn.setAttribute('aria-pressed', selected ? 'true' : 'false');
          const ord = btn.querySelector('.pick-order');
          ord.textContent = selected ? String(idx+1) : '';
          btn.disabled = !selected && cnt >= MAX_SELECTION;
        });
        const validForm =
          $('#voterName').value.trim().length>0 &&
          validPhoneDigits(normalizePhone($('#voterPhone').value)) &&
          cnt>0 && cnt<=MAX_SELECTION;
        $('#submitBtn').disabled = !validForm;
      }
      btns.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.dataset.id;
          const idx = selectedIds.indexOf(id);
          if (idx === -1){
            if (selectedIds.length >= MAX_SELECTION){ toast(`ìµœëŒ€ ${MAX_SELECTION}ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆë‹¤.`); return; }
            selectedIds.push(id);
          } else {
            selectedIds.splice(idx,1);
          }
          updateUI();
        });
      });
      $('#voterName').addEventListener('input', updateUI);
      $('#voterPhone').addEventListener('input', ()=>{
        const el=$('#voterPhone');
        el.value = formatKoreanPhone(el.value);
        updateUI();
      });
      updateUI();
    }

    /* 3) ë¼ì´íŠ¸ë°•ìŠ¤ */
    const lb = $('#lightbox'), lbImg = $('#lbImg'), lbCap = $('#lbCaption');
    const lbPrev = $('#lbPrev'), lbNext = $('#lbNext'), lbClose = $('#lbClose');
    let focusBackup = null;
    function showLightboxAt(i){ if (i<0) i = GALLERY.length-1; if (i>=GALLERY.length) i = 0; currentIndex = i; const {id,title,image,desc} = GALLERY[currentIndex]; lbImg.src = image; lbImg.alt = `${id} ${title} í™•ëŒ€ ì´ë¯¸ì§€`; lbCap.innerHTML = ''; const t=document.createElement('div'); t.className='lb-title'; t.textContent = id + ' Â· ' + title; lbCap.appendChild(t); const d=document.createElement('div'); d.className='lb-desc'; d.textContent = desc || ''; lbCap.appendChild(d); preloadNeighbors(); }
    function openLightbox(i){ focusBackup = document.activeElement; lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); document.documentElement.style.overflow = 'hidden'; showLightboxAt(i); lbClose.focus(); }
    function closeLightbox(){ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); document.documentElement.style.overflow = ''; if (focusBackup) focusBackup.focus(); }
    function preloadNeighbors(){ const prev = new Image(); prev.src = GALLERY[(currentIndex-1+GALLERY.length)%GALLERY.length].image; const next = new Image(); next.src = GALLERY[(currentIndex+1)%GALLERY.length].image; }
    lbPrev.addEventListener('click', ()=> showLightboxAt(currentIndex-1));
    lbNext.addEventListener('click', ()=> showLightboxAt(currentIndex+1));
    lbClose.addEventListener('click', closeLightbox);
    lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });
    document.addEventListener('keydown', (e)=>{ if (!lb.classList.contains('open')) return; if (e.key==='Escape') closeLightbox(); if (e.key==='ArrowLeft') showLightboxAt(currentIndex-1); if (e.key==='ArrowRight') showLightboxAt(currentIndex+1); });
    let sx=0, sy=0; lb.addEventListener('pointerdown', (e)=>{ sx=e.clientX; sy=e.clientY; }); lb.addEventListener('pointerup', (e)=>{ const dx=e.clientX-sx, dy=e.clientY-sy; if(Math.abs(dx)>50 && Math.abs(dx)>Math.abs(dy)){ if(dx<0) showLightboxAt(currentIndex+1); else showLightboxAt(currentIndex-1); } });

    /* 4) ì œì¶œ(JSONP) */
    function submitVote(evt){
      evt.preventDefault();
      const name = $('#voterName').value.trim();
      const phoneDigits = normalizePhone($('#voterPhone').value);
      if (!name){ toast('ì´ë¦„ì„ ì…ë ¥í•œë‹¤.'); return; }
      if (!validPhoneDigits(phoneDigits)){ toast('ì „í™”ë²ˆí˜¸ë¥¼ ìˆ«ìë¡œ ì •í™•íˆ ì…ë ¥í•œë‹¤.'); return; }
      if (localStorage.getItem(phoneKey(phoneDigits))){ toast('ì´ë¯¸ ì œì¶œí•œ ì „í™”ë²ˆí˜¸ì´ë‹¤.'); return; }

      const choices = (window.selectedIds || []).slice(0,MAX_SELECTION);
      if (choices.length < 1){ toast('ìµœì†Œ 1ê°œ ì‘í’ˆì„ ì„ íƒí•œë‹¤.'); return; }

      $('#submitBtn').disabled = true; $('#message').textContent = 'ì œì¶œì„ ì²˜ë¦¬í•œë‹¤â€¦';

      const cbName = `voteCallback_${Date.now()}_${Math.floor(Math.random()*1e6)}`;
      let scriptTag;
      window[cbName] = function(resp){
        try{ if (scriptTag) document.body.removeChild(scriptTag); }catch(e){}
        delete window[cbName];
        if (!resp || !resp.ok){
          const code = resp && resp.code ? resp.code : 'ERROR';
          if (code==='DUPLICATE'){ $('#message').innerHTML = '<span class="error">ì´ë¯¸ ì œì¶œí•œ ì „í™”ë²ˆí˜¸ì´ë‹¤. 1íšŒë§Œ ì œì¶œ ê°€ëŠ¥í•˜ë‹¤.</span>'; }
          else if (code==='INVALID'){ $('#message').innerHTML = '<span class="error">ì…ë ¥ ê°’ì´ ìœ íš¨í•˜ì§€ ì•Šë‹¤.</span>'; }
          else { $('#message').innerHTML = '<span class="error">ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. (ì›¹ì•± ê¶Œí•œ/ì‹œíŠ¸ ID í™•ì¸)</span>'; }
          $('#submitBtn').disabled = false; return;
        }
        localStorage.setItem(phoneKey(phoneDigits), '1');
        $('#message').inne
